
export CUDA_VISIBLE_DEVICES=7
export LD_LIBRARY_PATH=$(dirname $(python -c 'import torch; print(torch.__file__)'))/lib/

mkdir -p ./results_standard
mkdir -p ./results_varlen
mkdir -p ./results_kvcache
# =====================================================
# STANDARD ATTENTION BENCHMARKS
# =====================================================

echo "===== STANDARD ATTENTION BENCHMARKS ====="
===== STANDARD ATTENTION BENCHMARKS =====

# Modern LLM model configurations
echo "Testing modern LLM configurations..."
Testing modern LLM configurations...

# Qwen 2.5 Coder-32B configuration
S=1 Hqo=40 Hkv=8 D=128 && ./build/flash_attention_benchmark_standard \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  --disable-blocking-kernel --md "results_standard/qwen2.5-32b.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=40 num_kv_heads=8 head_size=128]
Pass: Cold: 0.076378ms GPU, 0.083766ms CPU, 0.50s total GPU, 0.86s total wall, 6560x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=40 num_kv_heads=8 head_size=128]
Pass: Cold: 0.161130ms GPU, 0.168530ms CPU, 0.50s total GPU, 0.65s total wall, 3104x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=40 num_kv_heads=8 head_size=128]
Pass: Cold: 0.504368ms GPU, 0.511403ms CPU, 1.15s total GPU, 1.26s total wall, 2272x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=40 num_kv_heads=8 head_size=128]
Pass: Cold: 1.775435ms GPU, 1.793500ms CPU, 1.62s total GPU, 1.68s total wall, 912x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=40 num_kv_heads=8 head_size=128]
Pass: Cold: 6.677520ms GPU, 6.718987ms CPU, 3.85s total GPU, 3.90s total wall, 576x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=40 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.81% > 0.50%)
Pass: Cold: 25.705187ms GPU, 25.735685ms CPU, 14.96s total GPU, 15.01s total wall, 582x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=40 num_kv_heads=8 head_size=128]
Pass: Cold: 103.354680ms GPU, 103.364080ms CPU, 9.51s total GPU, 9.51s total wall, 92x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        40 |            8 |       128 |    7.000 MiB |     5.000 MiB |           12 |    512 |   6560x |  83.766 us | 45.27% |  76.378 us | 12.19% |   6.703M | 164.744 GB/s | 17.66% |
|        1 |    1024 |        40 |            8 |       128 |   14.000 MiB |    10.000 MiB |           24 |   1024 |   3104x | 168.530 us | 16.44% | 161.130 us |  2.76% |   6.355M | 156.183 GB/s | 16.74% |
|        1 |    2048 |        40 |            8 |       128 |   28.000 MiB |    20.000 MiB |           48 |   2048 |   2272x | 511.403 us |  3.66% | 504.368 us |  3.37% |   4.061M |  99.791 GB/s | 10.69% |
|        1 |    4096 |        40 |            8 |       128 |   56.000 MiB |    40.000 MiB |           96 |   4096 |    912x |   1.794 ms |  7.88% |   1.775 ms |  1.35% |   2.307M |  56.698 GB/s |  6.08% |
|        1 |    8192 |        40 |            8 |       128 |  112.000 MiB |    80.000 MiB |          192 |   8192 |    576x |   6.719 ms |  7.25% |   6.678 ms |  1.20% |   1.227M |  30.150 GB/s |  3.23% |
|        1 |   16384 |        40 |            8 |       128 |  224.000 MiB |   160.000 MiB |          384 |  16384 |    582x |  25.736 ms |  1.59% |  25.705 ms |  0.81% | 637.381K |  15.664 GB/s |  1.68% |
|        1 |   32768 |        40 |            8 |       128 |  448.000 MiB |   320.000 MiB |          768 |  32768 |     92x | 103.364 ms |  0.50% | 103.355 ms |  0.50% | 317.044K |   7.792 GB/s |  0.84% |

# Phi-4 configuration
S=1 Hqo=40 Hkv=10 D=128 && ./build/flash_attention_benchmark_standard \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  --disable-blocking-kernel --md "results_standard/phi4.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=40 num_kv_heads=10 head_size=128]
Pass: Cold: 0.076259ms GPU, 0.083185ms CPU, 0.50s total GPU, 0.85s total wall, 6560x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=40 num_kv_heads=10 head_size=128]
Pass: Cold: 0.162184ms GPU, 0.171066ms CPU, 0.50s total GPU, 0.65s total wall, 3088x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=40 num_kv_heads=10 head_size=128]
Pass: Cold: 0.503525ms GPU, 0.512266ms CPU, 0.74s total GPU, 0.82s total wall, 1472x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=40 num_kv_heads=10 head_size=128]
Pass: Cold: 1.774741ms GPU, 1.795225ms CPU, 1.96s total GPU, 2.03s total wall, 1104x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=40 num_kv_heads=10 head_size=128]
Pass: Cold: 6.652375ms GPU, 6.680856ms CPU, 4.36s total GPU, 4.41s total wall, 656x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=40 num_kv_heads=10 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.69% > 0.50%)
Pass: Cold: 25.975228ms GPU, 26.002409ms CPU, 14.96s total GPU, 15.01s total wall, 576x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=40 num_kv_heads=10 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.69% > 0.50%)
Pass: Cold: 104.846716ms GPU, 104.915621ms CPU, 14.99s total GPU, 15.01s total wall, 143x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        40 |           10 |       128 |    7.500 MiB |     5.000 MiB |         12.5 |    512 |   6560x |  83.185 us | 17.86% |  76.259 us | 14.63% |   6.714M | 171.878 GB/s | 18.42% |
|        1 |    1024 |        40 |           10 |       128 |   15.000 MiB |    10.000 MiB |           25 |   1024 |   3088x | 171.066 us | 37.46% | 162.184 us |  2.57% |   6.314M | 161.634 GB/s | 17.32% |
|        1 |    2048 |        40 |           10 |       128 |   30.000 MiB |    20.000 MiB |           50 |   2048 |   1472x | 512.266 us | 12.54% | 503.525 us |  2.40% |   4.067M | 104.124 GB/s | 11.16% |
|        1 |    4096 |        40 |           10 |       128 |   60.000 MiB |    40.000 MiB |          100 |   4096 |   1104x |   1.795 ms | 18.37% |   1.775 ms |  1.58% |   2.308M |  59.083 GB/s |  6.33% |
|        1 |    8192 |        40 |           10 |       128 |  120.000 MiB |    80.000 MiB |          200 |   8192 |    656x |   6.681 ms |  5.63% |   6.652 ms |  1.09% |   1.231M |  31.525 GB/s |  3.38% |
|        1 |   16384 |        40 |           10 |       128 |  240.000 MiB |   160.000 MiB |          400 |  16384 |    576x |  26.002 ms |  1.59% |  25.975 ms |  0.69% | 630.755K |  16.147 GB/s |  1.73% |
|        1 |   32768 |        40 |           10 |       128 |  480.000 MiB |   320.000 MiB |          800 |  32768 |    143x | 104.916 ms |  1.01% | 104.847 ms |  0.69% | 312.532K |   8.001 GB/s |  0.86% |

# Mixtral-8x7B configuration
S=1 Hqo=32 Hkv=8 D=128 && ./build/flash_attention_benchmark_standard \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  --disable-blocking-kernel --md "results_standard/mixtral-7b.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.062481ms GPU, 0.069732ms CPU, 0.50s total GPU, 0.94s total wall, 8016x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.139072ms GPU, 0.145986ms CPU, 0.50s total GPU, 0.68s total wall, 3600x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.419428ms GPU, 0.426466ms CPU, 0.72s total GPU, 0.81s total wall, 1728x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1.444931ms GPU, 1.458551ms CPU, 2.64s total GPU, 2.74s total wall, 1824x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 5.395548ms GPU, 5.422017ms CPU, 6.22s total GPU, 6.30s total wall, 1152x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 20.929575ms GPU, 20.937929ms CPU, 7.70s total GPU, 7.72s total wall, 368x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.07s) while over noise threshold (0.81% > 0.50%)
Pass: Cold: 84.090988ms GPU, 84.111032ms CPU, 15.05s total GPU, 15.07s total wall, 179x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |       128 |    6.000 MiB |     4.000 MiB |           10 |    512 |   8016x |  69.732 us | 42.72% |  62.481 us | 23.64% |   8.194M | 167.822 GB/s | 17.99% |
|        1 |    1024 |        32 |            8 |       128 |   12.000 MiB |     8.000 MiB |           20 |   1024 |   3600x | 145.986 us |  5.83% | 139.072 us |  3.07% |   7.363M | 150.796 GB/s | 16.16% |
|        1 |    2048 |        32 |            8 |       128 |   24.000 MiB |    16.000 MiB |           40 |   2048 |   1728x | 426.466 us |  3.40% | 419.428 us |  2.94% |   4.883M | 100.001 GB/s | 10.72% |
|        1 |    4096 |        32 |            8 |       128 |   48.000 MiB |    32.000 MiB |           80 |   4096 |   1824x |   1.459 ms |  7.79% |   1.445 ms |  1.79% |   2.835M |  58.055 GB/s |  6.22% |
|        1 |    8192 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |   1152x |   5.422 ms |  6.63% |   5.396 ms |  1.18% |   1.518M |  31.095 GB/s |  3.33% |
|        1 |   16384 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |    368x |  20.938 ms |  0.91% |  20.930 ms |  0.91% | 782.816K |  16.032 GB/s |  1.72% |
|        1 |   32768 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |    179x |  84.111 ms |  0.83% |  84.091 ms |  0.81% | 389.673K |   7.981 GB/s |  0.86% |

# GPT-2 configuration
S=1 Hqo=12 Hkv=12 D=64 && ./build/flash_attention_benchmark_standard \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  --disable-blocking-kernel --md "results_standard/gpt2.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=12 num_kv_heads=12 head_size=64]
Pass: Cold: 0.029027ms GPU, 0.035987ms CPU, 0.50s total GPU, 1.50s total wall, 17232x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=12 num_kv_heads=12 head_size=64]
Pass: Cold: 0.057022ms GPU, 0.064556ms CPU, 0.50s total GPU, 0.95s total wall, 8784x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=12 num_kv_heads=12 head_size=64]
Pass: Cold: 0.121480ms GPU, 0.129507ms CPU, 0.50s total GPU, 0.70s total wall, 4128x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=12 num_kv_heads=12 head_size=64]
Pass: Cold: 0.365117ms GPU, 0.375314ms CPU, 0.50s total GPU, 0.57s total wall, 1376x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=12 num_kv_heads=12 head_size=64]
Pass: Cold: 1.277196ms GPU, 1.292559ms CPU, 1.47s total GPU, 1.54s total wall, 1152x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=12 num_kv_heads=12 head_size=64]
Pass: Cold: 4.750931ms GPU, 4.768641ms CPU, 3.80s total GPU, 3.85s total wall, 800x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=12 num_kv_heads=12 head_size=64]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.71% > 0.50%)
Pass: Cold: 18.413275ms GPU, 18.438303ms CPU, 14.95s total GPU, 15.01s total wall, 812x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|-------|---------|--------------|--------|
|        1 |     512 |        12 |           12 |        64 |    2.250 MiB |   768.000 KiB |            3 |    512 |  17232x |  35.987 us | 60.55% |  29.027 us | 9.05% | 17.639M | 108.373 GB/s | 11.61% |
|        1 |    1024 |        12 |           12 |        64 |    4.500 MiB |     1.500 MiB |            6 |   1024 |   8784x |  64.556 us | 65.44% |  57.022 us | 1.27% | 17.958M | 110.333 GB/s | 11.82% |
|        1 |    2048 |        12 |           12 |        64 |    9.000 MiB |     3.000 MiB |           12 |   2048 |   4128x | 129.507 us | 49.51% | 121.480 us | 3.47% | 16.859M | 103.580 GB/s | 11.10% |
|        1 |    4096 |        12 |           12 |        64 |   18.000 MiB |     6.000 MiB |           24 |   4096 |   1376x | 375.314 us | 18.48% | 365.117 us | 2.85% | 11.218M |  68.925 GB/s |  7.39% |
|        1 |    8192 |        12 |           12 |        64 |   36.000 MiB |    12.000 MiB |           48 |   8192 |   1152x |   1.293 ms | 14.98% |   1.277 ms | 1.82% |  6.414M |  39.408 GB/s |  4.22% |
|        1 |   16384 |        12 |           12 |        64 |   72.000 MiB |    24.000 MiB |           96 |  16384 |    800x |   4.769 ms |  5.28% |   4.751 ms | 1.02% |  3.449M |  21.188 GB/s |  2.27% |
|        1 |   32768 |        12 |           12 |        64 |  144.000 MiB |    48.000 MiB |          192 |  32768 |    812x |  18.438 ms |  1.59% |  18.413 ms | 0.71% |  1.780M |  10.934 GB/s |  1.17% |

# DeepSeek-R1 configuration
S=1 Hqo=128 Hkv=128 D=56 && ./build/flash_attention_benchmark_standard \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  --disable-blocking-kernel --md "results_standard/deepseek-r1.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 0.122698ms GPU, 0.130278ms CPU, 0.50s total GPU, 0.71s total wall, 4080x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 0.322217ms GPU, 0.329848ms CPU, 0.77s total GPU, 0.89s total wall, 2384x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 1.078092ms GPU, 1.089113ms CPU, 1.07s total GPU, 1.12s total wall, 992x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 3.890570ms GPU, 3.898070ms CPU, 0.76s total GPU, 0.77s total wall, 195x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 14.831887ms GPU, 14.839402ms CPU, 0.50s total GPU, 0.51s total wall, 34x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 58.019596ms GPU, 58.028060ms CPU, 1.22s total GPU, 1.22s total wall, 21x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 235.265955ms GPU, 235.278369ms CPU, 2.59s total GPU, 2.59s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |       128 |          128 |        56 |   21.000 MiB |     7.000 MiB |           28 |    512 |   4080x | 130.278 us | 37.58% | 122.698 us | 16.19% |   4.173M | 239.287 GB/s | 25.64% |
|        1 |    1024 |       128 |          128 |        56 |   42.000 MiB |    14.000 MiB |           56 |   1024 |   2384x | 329.848 us |  9.85% | 322.217 us |  2.07% |   3.178M | 182.238 GB/s | 19.53% |
|        1 |    2048 |       128 |          128 |        56 |   84.000 MiB |    28.000 MiB |          112 |   2048 |    992x |   1.089 ms |  6.97% |   1.078 ms |  0.70% |   1.900M | 108.934 GB/s | 11.67% |
|        1 |    4096 |       128 |          128 |        56 |  168.000 MiB |    56.000 MiB |          224 |   4096 |    195x |   3.898 ms |  0.54% |   3.891 ms |  0.50% |   1.053M |  60.372 GB/s |  6.47% |
|        1 |    8192 |       128 |          128 |        56 |  336.000 MiB |   112.000 MiB |          448 |   8192 |     34x |  14.839 ms |  0.50% |  14.832 ms |  0.50% | 552.324K |  31.672 GB/s |  3.39% |
|        1 |   16384 |       128 |          128 |        56 |  672.000 MiB |   224.000 MiB |          896 |  16384 |     21x |  58.028 ms |  0.49% |  58.020 ms |  0.49% | 282.387K |  16.193 GB/s |  1.74% |
|        1 |   32768 |       128 |          128 |        56 |    1.312 GiB |   448.000 MiB |         1792 |  32768 |     11x | 235.278 ms |  0.09% | 235.266 ms |  0.09% | 139.281K |   7.987 GB/s |  0.86% |

# Legacy configurations for backwards compatibility
echo "Testing legacy model configurations..."
Testing legacy model configurations...

# Llama 2 7B-like (32 heads, 128 dim)
S=1 Hqo=32 Hkv=32 D=128 && ./build/flash_attention_benchmark_standard \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  --disable-blocking-kernel --md "results_standard/llama2-7b.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 0.067091ms GPU, 0.074554ms CPU, 0.50s total GPU, 0.91s total wall, 7456x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 0.145748ms GPU, 0.153384ms CPU, 0.50s total GPU, 0.67s total wall, 3440x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 0.430072ms GPU, 0.438741ms CPU, 0.61s total GPU, 0.69s total wall, 1424x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 1.473850ms GPU, 1.485991ms CPU, 1.53s total GPU, 1.59s total wall, 1040x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 5.493738ms GPU, 5.516397ms CPU, 4.57s total GPU, 4.63s total wall, 832x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=32 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.96% > 0.50%)
Pass: Cold: 21.334691ms GPU, 21.359849ms CPU, 14.96s total GPU, 15.01s total wall, 701x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 85.747992ms GPU, 85.756727ms CPU, 0.94s total GPU, 0.94s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |           32 |       128 |   12.000 MiB |     4.000 MiB |           16 |    512 |   7456x |  74.554 us | 64.42% |  67.091 us | 47.29% |   7.631M | 250.066 GB/s | 26.80% |
|        1 |    1024 |        32 |           32 |       128 |   24.000 MiB |     8.000 MiB |           32 |   1024 |   3440x | 153.384 us | 30.54% | 145.748 us |  2.93% |   7.026M | 230.222 GB/s | 24.67% |
|        1 |    2048 |        32 |           32 |       128 |   48.000 MiB |    16.000 MiB |           64 |   2048 |   1424x | 438.741 us | 10.89% | 430.072 us |  2.81% |   4.762M | 156.041 GB/s | 16.72% |
|        1 |    4096 |        32 |           32 |       128 |   96.000 MiB |    32.000 MiB |          128 |   4096 |   1040x |   1.486 ms |  6.01% |   1.474 ms |  1.62% |   2.779M |  91.066 GB/s |  9.76% |
|        1 |    8192 |        32 |           32 |       128 |  192.000 MiB |    64.000 MiB |          256 |   8192 |    832x |   5.516 ms |  4.90% |   5.494 ms |  1.05% |   1.491M |  48.862 GB/s |  5.24% |
|        1 |   16384 |        32 |           32 |       128 |  384.000 MiB |   128.000 MiB |          512 |  16384 |    701x |  21.360 ms |  1.76% |  21.335 ms |  0.96% | 767.951K |  25.164 GB/s |  2.70% |
|        1 |   32768 |        32 |           32 |       128 |  768.000 MiB |   256.000 MiB |         1024 |  32768 |     11x |  85.757 ms |  0.39% |  85.748 ms |  0.39% | 382.143K |  12.522 GB/s |  1.34% |

# Llama 2 70B-like (80 heads, heads_size=128) with GQA(8)
S=1 Hqo=64 Hkv=8 D=128 && ./build/flash_attention_benchmark_standard \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  --disable-blocking-kernel --md "results_standard/llama2-70b-gqa8.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=64 num_kv_heads=8 head_size=128]
Pass: Cold: 0.098857ms GPU, 0.106364ms CPU, 0.50s total GPU, 0.77s total wall, 5072x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=64 num_kv_heads=8 head_size=128]
Pass: Cold: 0.235941ms GPU, 0.244196ms CPU, 0.50s total GPU, 0.61s total wall, 2128x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=64 num_kv_heads=8 head_size=128]
Pass: Cold: 0.779681ms GPU, 0.790066ms CPU, 1.20s total GPU, 1.28s total wall, 1536x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=64 num_kv_heads=8 head_size=128]
Pass: Cold: 2.801419ms GPU, 2.818874ms CPU, 1.57s total GPU, 1.60s total wall, 560x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=64 num_kv_heads=8 head_size=128]
Pass: Cold: 10.635782ms GPU, 10.643555ms CPU, 1.83s total GPU, 1.84s total wall, 172x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=64 num_kv_heads=8 head_size=128]
Pass: Cold: 41.494144ms GPU, 41.527979ms CPU, 5.31s total GPU, 5.32s total wall, 128x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=64 num_kv_heads=8 head_size=128]
Pass: Cold: 167.354740ms GPU, 167.365437ms CPU, 1.84s total GPU, 1.84s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        64 |            8 |       128 |   10.000 MiB |     8.000 MiB |           18 |    512 |   5072x | 106.364 us | 39.42% |  98.857 us | 19.00% |   5.179M | 190.927 GB/s | 20.46% |
|        1 |    1024 |        64 |            8 |       128 |   20.000 MiB |    16.000 MiB |           36 |   1024 |   2128x | 244.196 us | 18.42% | 235.941 us |  2.16% |   4.340M | 159.992 GB/s | 17.15% |
|        1 |    2048 |        64 |            8 |       128 |   40.000 MiB |    32.000 MiB |           72 |   2048 |   1536x | 790.066 us |  9.37% | 779.681 us |  1.77% |   2.627M |  96.831 GB/s | 10.38% |
|        1 |    4096 |        64 |            8 |       128 |   80.000 MiB |    64.000 MiB |          144 |   4096 |    560x |   2.819 ms |  5.53% |   2.801 ms |  0.86% |   1.462M |  53.899 GB/s |  5.78% |
|        1 |    8192 |        64 |            8 |       128 |  160.000 MiB |   128.000 MiB |          288 |   8192 |    172x |  10.644 ms |  0.50% |  10.636 ms |  0.50% | 770.230K |  28.394 GB/s |  3.04% |
|        1 |   16384 |        64 |            8 |       128 |  320.000 MiB |   256.000 MiB |          576 |  16384 |    128x |  41.528 ms |  0.97% |  41.494 ms |  0.63% | 394.851K |  14.556 GB/s |  1.56% |
|        1 |   32768 |        64 |            8 |       128 |  640.000 MiB |   512.000 MiB |         1152 |  32768 |     11x | 167.365 ms |  0.43% | 167.355 ms |  0.42% | 195.800K |   7.218 GB/s |  0.77% |

# Batch size scaling tests with Mixtral-like configuration
echo "Testing batch size scaling..."
Testing batch size scaling...
for S in 1 2 4 8 16 32 64; do
  Hqo=32 Hkv=8 D=128 && ./build/flash_attention_benchmark_standard \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
    --disable-blocking-kernel --md "results_standard/batch-scaling-$S.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.059615ms GPU, 0.067037ms CPU, 0.50s total GPU, 0.94s total wall, 8400x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.139830ms GPU, 0.147022ms CPU, 0.50s total GPU, 0.67s total wall, 3584x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.417925ms GPU, 0.426455ms CPU, 0.64s total GPU, 0.72s total wall, 1536x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1.448118ms GPU, 1.461137ms CPU, 1.48s total GPU, 1.54s total wall, 1024x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 5.417574ms GPU, 5.439258ms CPU, 6.41s total GPU, 6.49s total wall, 1184x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 20.993508ms GPU, 21.012203ms CPU, 13.77s total GPU, 13.81s total wall, 656x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.04s) while over noise threshold (0.63% > 0.50%)
Pass: Cold: 84.449280ms GPU, 84.458302ms CPU, 15.03s total GPU, 15.04s total wall, 178x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |       128 |    6.000 MiB |     4.000 MiB |           10 |    512 |   8400x |  67.037 us | 42.70% |  59.615 us | 11.32% |   8.588M | 175.890 GB/s | 18.85% |
|        1 |    1024 |        32 |            8 |       128 |   12.000 MiB |     8.000 MiB |           20 |   1024 |   3584x | 147.022 us | 18.86% | 139.830 us |  3.13% |   7.323M | 149.979 GB/s | 16.07% |
|        1 |    2048 |        32 |            8 |       128 |   24.000 MiB |    16.000 MiB |           40 |   2048 |   1536x | 426.455 us |  9.28% | 417.925 us |  2.58% |   4.900M | 100.360 GB/s | 10.76% |
|        1 |    4096 |        32 |            8 |       128 |   48.000 MiB |    32.000 MiB |           80 |   4096 |   1024x |   1.461 ms |  6.94% |   1.448 ms |  1.51% |   2.828M |  57.928 GB/s |  6.21% |
|        1 |    8192 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |   1184x |   5.439 ms |  4.19% |   5.418 ms |  0.97% |   1.512M |  30.968 GB/s |  3.32% |
|        1 |   16384 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |    656x |  21.012 ms |  1.28% |  20.994 ms |  0.92% | 780.432K |  15.983 GB/s |  1.71% |
|        1 |   32768 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |    178x |  84.458 ms |  0.63% |  84.449 ms |  0.63% | 388.020K |   7.947 GB/s |  0.85% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=2 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.103276ms GPU, 0.110489ms CPU, 0.50s total GPU, 0.76s total wall, 4848x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=2 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.239009ms GPU, 0.246714ms CPU, 0.50s total GPU, 0.60s total wall, 2096x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=2 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.785640ms GPU, 0.796770ms CPU, 1.66s total GPU, 1.78s total wall, 2112x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=2 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 2.820715ms GPU, 2.834659ms CPU, 2.48s total GPU, 2.53s total wall, 880x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=2 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 10.751902ms GPU, 10.759359ms CPU, 0.56s total GPU, 0.56s total wall, 52x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=2 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 42.207642ms GPU, 42.216013ms CPU, 4.01s total GPU, 4.01s total wall, 95x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=2 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 170.268207ms GPU, 170.277660ms CPU, 1.87s total GPU, 1.87s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        2 |     512 |        32 |            8 |       128 |   12.000 MiB |     8.000 MiB |           20 |   1024 |   4848x | 110.489 us | 20.43% | 103.276 us | 16.41% |   9.915M | 203.063 GB/s | 21.76% |
|        2 |    1024 |        32 |            8 |       128 |   24.000 MiB |    16.000 MiB |           40 |   2048 |   2096x | 246.714 us | 13.25% | 239.009 us |  2.17% |   8.569M | 175.487 GB/s | 18.81% |
|        2 |    2048 |        32 |            8 |       128 |   48.000 MiB |    32.000 MiB |           80 |   4096 |   2112x | 796.770 us | 12.82% | 785.640 us |  2.04% |   5.214M | 106.774 GB/s | 11.44% |
|        2 |    4096 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |    880x |   2.835 ms |  5.19% |   2.821 ms |  0.93% |   2.904M |  59.479 GB/s |  6.37% |
|        2 |    8192 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |     52x |  10.759 ms |  0.50% |  10.752 ms |  0.50% |   1.524M |  31.208 GB/s |  3.34% |
|        2 |   16384 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |     95x |  42.216 ms |  0.50% |  42.208 ms |  0.50% | 776.352K |  15.900 GB/s |  1.70% |
|        2 |   32768 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |  65536 |     11x | 170.278 ms |  0.15% | 170.268 ms |  0.15% | 384.899K |   7.883 GB/s |  0.84% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=4 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.167741ms GPU, 0.175695ms CPU, 0.50s total GPU, 0.66s total wall, 2992x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=4 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.447505ms GPU, 0.455774ms CPU, 0.91s total GPU, 1.01s total wall, 2032x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=4 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1.517655ms GPU, 1.530120ms CPU, 1.14s total GPU, 1.18s total wall, 752x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=4 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 5.594761ms GPU, 5.618864ms CPU, 8.06s total GPU, 8.16s total wall, 1440x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=4 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.59% > 0.50%)
Pass: Cold: 21.478230ms GPU, 21.489430ms CPU, 14.97s total GPU, 15.01s total wall, 697x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=4 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.06s) while over noise threshold (0.65% > 0.50%)
Pass: Cold: 84.548614ms GPU, 84.557436ms CPU, 15.05s total GPU, 15.06s total wall, 178x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=4 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 341.441071ms GPU, 341.452496ms CPU, 3.76s total GPU, 3.76s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        4 |     512 |        32 |            8 |       128 |   24.000 MiB |    16.000 MiB |           40 |   2048 |   2992x | 175.695 us | 25.39% | 167.741 us | 15.80% |  12.209M | 250.046 GB/s | 26.80% |
|        4 |    1024 |        32 |            8 |       128 |   48.000 MiB |    32.000 MiB |           80 |   4096 |   2032x | 455.774 us |  8.29% | 447.505 us |  1.63% |   9.153M | 187.453 GB/s | 20.09% |
|        4 |    2048 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |    752x |   1.530 ms |  7.61% |   1.518 ms |  1.11% |   5.398M | 110.547 GB/s | 11.85% |
|        4 |    4096 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |   1440x |   5.619 ms |  6.30% |   5.595 ms |  1.00% |   2.928M |  59.975 GB/s |  6.43% |
|        4 |    8192 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |    697x |  21.489 ms |  0.72% |  21.478 ms |  0.59% |   1.526M |  31.245 GB/s |  3.35% |
|        4 |   16384 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |  65536 |    178x |  84.557 ms |  0.65% |  84.549 ms |  0.65% | 775.128K |  15.875 GB/s |  1.70% |
|        4 |   32768 |        32 |            8 |       128 |    1.500 GiB |     1.000 GiB |         2560 | 131072 |     11x | 341.452 ms |  0.19% | 341.441 ms |  0.19% | 383.879K |   7.862 GB/s |  0.84% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=8 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.317938ms GPU, 0.327773ms CPU, 0.50s total GPU, 0.59s total wall, 1584x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=8 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.871001ms GPU, 0.884313ms CPU, 1.53s total GPU, 1.63s total wall, 1760x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=8 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 3.029440ms GPU, 3.039340ms CPU, 3.44s total GPU, 3.51s total wall, 1136x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=8 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 11.251772ms GPU, 11.278555ms CPU, 6.30s total GPU, 6.34s total wall, 560x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=8 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.59% > 0.50%)
Pass: Cold: 42.928897ms GPU, 42.948562ms CPU, 14.98s total GPU, 15.01s total wall, 349x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=8 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.07s) while over noise threshold (0.76% > 0.50%)
Pass: Cold: 169.226345ms GPU, 169.235943ms CPU, 15.06s total GPU, 15.07s total wall, 89x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=8 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 685.624129ms GPU, 685.638241ms CPU, 7.54s total GPU, 7.54s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        8 |     512 |        32 |            8 |       128 |   48.000 MiB |    32.000 MiB |           80 |   4096 |   1584x | 327.773 us | 27.00% | 317.938 us | 15.54% |  12.883M | 263.844 GB/s | 28.28% |
|        8 |    1024 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |   1760x | 884.313 us | 13.88% | 871.001 us |  1.58% |   9.405M | 192.620 GB/s | 20.64% |
|        8 |    2048 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |   1136x |   3.039 ms |  2.23% |   3.029 ms |  1.46% |   5.408M | 110.761 GB/s | 11.87% |
|        8 |    4096 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |    560x |  11.279 ms |  3.45% |  11.252 ms |  1.04% |   2.912M |  59.643 GB/s |  6.39% |
|        8 |    8192 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |  65536 |    349x |  42.949 ms |  0.75% |  42.929 ms |  0.59% |   1.527M |  31.265 GB/s |  3.35% |
|        8 |   16384 |        32 |            8 |       128 |    1.500 GiB |     1.000 GiB |         2560 | 131072 |     89x | 169.236 ms |  0.76% | 169.226 ms |  0.76% | 774.537K |  15.863 GB/s |  1.70% |
|        8 |   32768 |        32 |            8 |       128 |    3.000 GiB |     2.000 GiB |         5120 | 262144 |     11x | 685.638 ms |  0.16% | 685.624 ms |  0.16% | 382.344K |   7.830 GB/s |  0.84% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=16 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.601544ms GPU, 0.612048ms CPU, 0.57s total GPU, 0.62s total wall, 944x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=16 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1.747452ms GPU, 1.759499ms CPU, 2.60s total GPU, 2.69s total wall, 1488x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=16 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 6.112580ms GPU, 6.140120ms CPU, 8.61s total GPU, 8.71s total wall, 1408x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 22.477831ms GPU, 22.485765ms CPU, 6.83s total GPU, 6.85s total wall, 304x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=16 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.02s) while over noise threshold (0.69% > 0.50%)
Pass: Cold: 85.788906ms GPU, 85.797885ms CPU, 15.01s total GPU, 15.02s total wall, 175x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=16 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 338.379406ms GPU, 338.390696ms CPU, 3.72s total GPU, 3.72s total wall, 11x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=16 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1365.667847ms GPU, 1365.688001ms CPU, 15.02s total GPU, 15.02s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|       16 |     512 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |    944x | 612.048 us | 20.10% | 601.544 us | 13.62% |  13.618M | 278.903 GB/s | 29.89% |
|       16 |    1024 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |   1488x |   1.759 ms |  4.83% |   1.747 ms |  1.47% |   9.376M | 192.019 GB/s | 20.58% |
|       16 |    2048 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |   1408x |   6.140 ms |  6.30% |   6.113 ms |  1.08% |   5.361M | 109.788 GB/s | 11.77% |
|       16 |    4096 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |  65536 |    304x |  22.486 ms |  0.81% |  22.478 ms |  0.81% |   2.916M |  59.711 GB/s |  6.40% |
|       16 |    8192 |        32 |            8 |       128 |    1.500 GiB |     1.000 GiB |         2560 | 131072 |    175x |  85.798 ms |  0.69% |  85.789 ms |  0.69% |   1.528M |  31.290 GB/s |  3.35% |
|       16 |   16384 |        32 |            8 |       128 |    3.000 GiB |     2.000 GiB |         5120 | 262144 |     11x | 338.391 ms |  0.17% | 338.379 ms |  0.17% | 774.704K |  15.866 GB/s |  1.70% |
|       16 |   32768 |        32 |            8 |       128 |    6.000 GiB |     4.000 GiB |        10240 | 524288 |     11x |    1.366 s |  0.08% |    1.366 s |  0.08% | 383.906K |   7.862 GB/s |  0.84% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=32 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1.113958ms GPU, 1.125824ms CPU, 3.35s total GPU, 3.53s total wall, 3008x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=32 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 3.527724ms GPU, 3.546729ms CPU, 2.71s total GPU, 2.76s total wall, 768x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=32 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (0.73% > 0.50%)
Pass: Cold: 12.186616ms GPU, 12.234331ms CPU, 14.89s total GPU, 15.01s total wall, 1222x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=32 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 44.868754ms GPU, 44.879048ms CPU, 0.63s total GPU, 0.63s total wall, 14x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=32 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 171.806159ms GPU, 171.819288ms CPU, 1.89s total GPU, 1.89s total wall, 11x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=32 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 675.789456ms GPU, 675.811119ms CPU, 7.43s total GPU, 7.44s total wall, 11x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=32 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (16.44s) before accumulating min_samples (6 < 10)
Pass: Cold: 2739.494914ms GPU, 2739.545490ms CPU, 16.44s total GPU, 16.44s total wall, 6x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens  | Samples |  CPU Time  | Noise |  GPU Time  | Noise |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|---------|---------|------------|-------|------------|-------|----------|--------------|--------|
|       32 |     512 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |   16384 |   3008x |   1.126 ms | 9.61% |   1.114 ms | 5.36% |  14.708M | 301.218 GB/s | 32.28% |
|       32 |    1024 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |   32768 |    768x |   3.547 ms | 7.21% |   3.528 ms | 1.21% |   9.289M | 190.233 GB/s | 20.39% |
|       32 |    2048 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |   65536 |   1222x |  12.234 ms | 4.27% |  12.187 ms | 0.73% |   5.378M | 110.135 GB/s | 11.80% |
|       32 |    4096 |        32 |            8 |       128 |    1.500 GiB |     1.000 GiB |         2560 |  131072 |     14x |  44.879 ms | 0.49% |  44.869 ms | 0.49% |   2.921M |  59.827 GB/s |  6.41% |
|       32 |    8192 |        32 |            8 |       128 |    3.000 GiB |     2.000 GiB |         5120 |  262144 |     11x | 171.819 ms | 0.47% | 171.806 ms | 0.47% |   1.526M |  31.249 GB/s |  3.35% |
|       32 |   16384 |        32 |            8 |       128 |    6.000 GiB |     4.000 GiB |        10240 |  524288 |     11x | 675.811 ms | 0.08% | 675.789 ms | 0.08% | 775.816K |  15.889 GB/s |  1.70% |
|       32 |   32768 |        32 |            8 |       128 |   12.000 GiB |     8.000 GiB |        20480 | 1048576 |      6x |    2.740 s | 0.04% |    2.739 s | 0.04% | 382.763K |   7.839 GB/s |  0.84% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=64 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 2.255570ms GPU, 2.273520ms CPU, 6.78s total GPU, 6.99s total wall, 3008x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=64 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 7.042927ms GPU, 7.070806ms CPU, 4.73s total GPU, 4.78s total wall, 672x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=64 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 24.326495ms GPU, 24.335376ms CPU, 0.92s total GPU, 0.93s total wall, 38x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=64 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 89.858150ms GPU, 89.869631ms CPU, 7.19s total GPU, 7.19s total wall, 80x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=64 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 342.661633ms GPU, 342.674119ms CPU, 5.48s total GPU, 5.48s total wall, 16x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=64 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1351.243109ms GPU, 1351.265586ms CPU, 14.86s total GPU, 14.86s total wall, 11x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=64 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Skip: OOM: Zxl
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens  | Samples |  CPU Time  | Noise  |  GPU Time  | Noise |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|---------|---------|------------|--------|------------|-------|----------|--------------|--------|
|       64 |     512 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |   32768 |   3008x |   2.274 ms | 10.68% |   2.256 ms | 3.69% |  14.528M | 297.525 GB/s | 31.88% |
|       64 |    1024 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |   65536 |    672x |   7.071 ms |  4.99% |   7.043 ms | 1.01% |   9.305M | 190.571 GB/s | 20.42% |
|       64 |    2048 |        32 |            8 |       128 |    1.500 GiB |     1.000 GiB |         2560 |  131072 |     38x |  24.335 ms |  0.50% |  24.326 ms | 0.50% |   5.388M | 110.347 GB/s | 11.83% |
|       64 |    4096 |        32 |            8 |       128 |    3.000 GiB |     2.000 GiB |         5120 |  262144 |     80x |  89.870 ms |  0.61% |  89.858 ms | 0.61% |   2.917M |  59.746 GB/s |  6.40% |
|       64 |    8192 |        32 |            8 |       128 |    6.000 GiB |     4.000 GiB |        10240 |  524288 |     16x | 342.674 ms |  0.50% | 342.662 ms | 0.50% |   1.530M |  31.335 GB/s |  3.36% |
|       64 |   16384 |        32 |            8 |       128 |   12.000 GiB |     8.000 GiB |        20480 | 1048576 |     11x |    1.351 s |  0.01% |    1.351 s | 0.00% | 776.008K |  15.893 GB/s |  1.70% |

# GQA ratio tests (increasingly important in modern LLMs)
echo "Testing GQA ratio impact..."
Testing GQA ratio impact...
S=1 Hqo=32 && for R in 1 2 4 5 8 16 32; do
  Hkv=$((Hqo / R))
  # Skip if division resulted in zero
  if [ $Hkv -gt 0 ]; then
    D=128 && ./build/flash_attention_benchmark_standard \
      -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
      --disable-blocking-kernel --md "results_standard/gqa-ratio-$R.md"
  fi
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 0.065533ms GPU, 0.072991ms CPU, 0.50s total GPU, 0.91s total wall, 7632x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 0.145935ms GPU, 0.153164ms CPU, 0.50s total GPU, 0.67s total wall, 3440x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 0.431658ms GPU, 0.439858ms CPU, 0.63s total GPU, 0.71s total wall, 1456x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 1.480950ms GPU, 1.498096ms CPU, 1.21s total GPU, 1.26s total wall, 816x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 5.526348ms GPU, 5.545678ms CPU, 3.36s total GPU, 3.40s total wall, 608x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=32 head_size=128]
Warn: Current measurement timed out (15.02s) while over noise threshold (0.95% > 0.50%)
Pass: Cold: 21.441454ms GPU, 21.467738ms CPU, 14.97s total GPU, 15.02s total wall, 698x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=32 head_size=128]
Pass: Cold: 85.921435ms GPU, 85.933815ms CPU, 1.98s total GPU, 1.98s total wall, 23x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |           32 |       128 |   12.000 MiB |     4.000 MiB |           16 |    512 |   7632x |  72.991 us | 46.17% |  65.533 us | 10.70% |   7.813M | 256.011 GB/s | 27.44% |
|        1 |    1024 |        32 |           32 |       128 |   24.000 MiB |     8.000 MiB |           32 |   1024 |   3440x | 153.164 us | 20.80% | 145.935 us |  2.99% |   7.017M | 229.927 GB/s | 24.64% |
|        1 |    2048 |        32 |           32 |       128 |   48.000 MiB |    16.000 MiB |           64 |   2048 |   1456x | 439.858 us | 12.02% | 431.658 us |  2.85% |   4.744M | 155.468 GB/s | 16.66% |
|        1 |    4096 |        32 |           32 |       128 |   96.000 MiB |    32.000 MiB |          128 |   4096 |    816x |   1.498 ms | 11.30% |   1.481 ms |  1.64% |   2.766M |  90.629 GB/s |  9.71% |
|        1 |    8192 |        32 |           32 |       128 |  192.000 MiB |    64.000 MiB |          256 |   8192 |    608x |   5.546 ms |  4.93% |   5.526 ms |  1.23% |   1.482M |  48.574 GB/s |  5.21% |
|        1 |   16384 |        32 |           32 |       128 |  384.000 MiB |   128.000 MiB |          512 |  16384 |    698x |  21.468 ms |  1.95% |  21.441 ms |  0.95% | 764.127K |  25.039 GB/s |  2.68% |
|        1 |   32768 |        32 |           32 |       128 |  768.000 MiB |   256.000 MiB |         1024 |  32768 |     23x |  85.934 ms |  0.50% |  85.921 ms |  0.50% | 381.372K |  12.497 GB/s |  1.34% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=16 head_size=128]
Pass: Cold: 0.062336ms GPU, 0.070362ms CPU, 0.50s total GPU, 0.95s total wall, 8032x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=16 head_size=128]
Pass: Cold: 0.141494ms GPU, 0.148784ms CPU, 0.50s total GPU, 0.67s total wall, 3536x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=16 head_size=128]
Pass: Cold: 0.423817ms GPU, 0.433000ms CPU, 0.50s total GPU, 0.56s total wall, 1184x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=16 head_size=128]
Pass: Cold: 1.461801ms GPU, 1.471720ms CPU, 1.73s total GPU, 1.79s total wall, 1184x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=16 head_size=128]
Pass: Cold: 5.450208ms GPU, 5.473976ms CPU, 6.89s total GPU, 6.98s total wall, 1264x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=16 head_size=128]
Pass: Cold: 21.077394ms GPU, 21.085427ms CPU, 0.59s total GPU, 0.59s total wall, 28x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=16 head_size=128]
Warn: Current measurement timed out (15.06s) while over noise threshold (0.62% > 0.50%)
Pass: Cold: 84.998774ms GPU, 85.008040ms CPU, 15.04s total GPU, 15.06s total wall, 177x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |           16 |       128 |    8.000 MiB |     4.000 MiB |           12 |    512 |   8032x |  70.362 us | 65.21% |  62.336 us | 14.16% |   8.214M | 201.857 GB/s | 21.63% |
|        1 |    1024 |        32 |           16 |       128 |   16.000 MiB |     8.000 MiB |           24 |   1024 |   3536x | 148.784 us | 26.08% | 141.494 us |  3.13% |   7.237M | 177.858 GB/s | 19.06% |
|        1 |    2048 |        32 |           16 |       128 |   32.000 MiB |    16.000 MiB |           48 |   2048 |   1184x | 433.000 us | 15.65% | 423.817 us |  3.28% |   4.832M | 118.758 GB/s | 12.73% |
|        1 |    4096 |        32 |           16 |       128 |   64.000 MiB |    32.000 MiB |           96 |   4096 |   1184x |   1.472 ms |  3.94% |   1.462 ms |  1.44% |   2.802M |  68.863 GB/s |  7.38% |
|        1 |    8192 |        32 |           16 |       128 |  128.000 MiB |    64.000 MiB |          192 |   8192 |   1264x |   5.474 ms |  5.58% |   5.450 ms |  1.02% |   1.503M |  36.939 GB/s |  3.96% |
|        1 |   16384 |        32 |           16 |       128 |  256.000 MiB |   128.000 MiB |          384 |  16384 |     28x |  21.085 ms |  0.50% |  21.077 ms |  0.49% | 777.326K |  19.104 GB/s |  2.05% |
|        1 |   32768 |        32 |           16 |       128 |  512.000 MiB |   256.000 MiB |          768 |  32768 |    177x |  85.008 ms |  0.62% |  84.999 ms |  0.62% | 385.511K |   9.474 GB/s |  1.02% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.060720ms GPU, 0.068280ms CPU, 0.50s total GPU, 0.95s total wall, 8240x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.139683ms GPU, 0.147787ms CPU, 0.50s total GPU, 0.68s total wall, 3584x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.419627ms GPU, 0.427960ms CPU, 0.73s total GPU, 0.81s total wall, 1728x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1.456942ms GPU, 1.468176ms CPU, 1.59s total GPU, 1.64s total wall, 1088x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 5.432253ms GPU, 5.459875ms CPU, 3.74s total GPU, 3.79s total wall, 688x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.02s) while over noise threshold (0.97% > 0.50%)
Pass: Cold: 21.080674ms GPU, 21.127707ms CPU, 14.95s total GPU, 15.02s total wall, 709x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 84.503272ms GPU, 84.513767ms CPU, 0.93s total GPU, 0.93s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |       128 |    6.000 MiB |     4.000 MiB |           10 |    512 |   8240x |  68.280 us | 58.81% |  60.720 us | 14.08% |   8.432M | 172.690 GB/s | 18.51% |
|        1 |    1024 |        32 |            8 |       128 |   12.000 MiB |     8.000 MiB |           20 |   1024 |   3584x | 147.787 us | 42.68% | 139.683 us |  3.04% |   7.331M | 150.136 GB/s | 16.09% |
|        1 |    2048 |        32 |            8 |       128 |   24.000 MiB |    16.000 MiB |           40 |   2048 |   1728x | 427.960 us |  8.80% | 419.627 us |  2.99% |   4.881M |  99.953 GB/s | 10.71% |
|        1 |    4096 |        32 |            8 |       128 |   48.000 MiB |    32.000 MiB |           80 |   4096 |   1088x |   1.468 ms |  5.07% |   1.457 ms |  1.74% |   2.811M |  57.577 GB/s |  6.17% |
|        1 |    8192 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |    688x |   5.460 ms |  6.97% |   5.432 ms |  1.02% |   1.508M |  30.884 GB/s |  3.31% |
|        1 |   16384 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |    709x |  21.128 ms |  2.57% |  21.081 ms |  0.97% | 777.205K |  15.917 GB/s |  1.71% |
|        1 |   32768 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |     11x |  84.514 ms |  0.26% |  84.503 ms |  0.26% | 387.772K |   7.942 GB/s |  0.85% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=6 head_size=128]
Skip: OOM: \O
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=6 head_size=128]
Skip: OOM: \O
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=6 head_size=128]
Skip: OOM: \O
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=6 head_size=128]
Skip: OOM: \O
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=6 head_size=128]
Skip: OOM: \O
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=6 head_size=128]
Skip: OOM: \O
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=6 head_size=128]
Skip: OOM: \O
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

No data -- check log.
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=4 head_size=128]
Pass: Cold: 0.059074ms GPU, 0.066849ms CPU, 0.50s total GPU, 0.96s total wall, 8464x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=4 head_size=128]
Pass: Cold: 0.138852ms GPU, 0.146220ms CPU, 0.50s total GPU, 0.68s total wall, 3616x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=4 head_size=128]
Pass: Cold: 0.415160ms GPU, 0.422824ms CPU, 0.60s total GPU, 0.67s total wall, 1440x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=4 head_size=128]
Pass: Cold: 1.445561ms GPU, 1.458532ms CPU, 1.69s total GPU, 1.75s total wall, 1168x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=4 head_size=128]
Pass: Cold: 5.411462ms GPU, 5.444895ms CPU, 3.81s total GPU, 3.86s total wall, 704x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=4 head_size=128]
Pass: Cold: 20.860074ms GPU, 20.867871ms CPU, 0.50s total GPU, 0.50s total wall, 24x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=4 head_size=128]
Pass: Cold: 83.451811ms GPU, 83.461093ms CPU, 0.92s total GPU, 0.92s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            4 |       128 |    5.000 MiB |     4.000 MiB |            9 |    512 |   8464x |  66.849 us | 77.37% |  59.074 us | 13.12% |   8.667M | 159.751 GB/s | 17.12% |
|        1 |    1024 |        32 |            4 |       128 |   10.000 MiB |     8.000 MiB |           18 |   1024 |   3616x | 146.220 us | 21.66% | 138.852 us |  3.06% |   7.375M | 135.932 GB/s | 14.57% |
|        1 |    2048 |        32 |            4 |       128 |   20.000 MiB |    16.000 MiB |           36 |   2048 |   1440x | 422.824 us |  7.06% | 415.160 us |  2.42% |   4.933M |  90.926 GB/s |  9.74% |
|        1 |    4096 |        32 |            4 |       128 |   40.000 MiB |    32.000 MiB |           72 |   4096 |   1168x |   1.459 ms |  6.57% |   1.446 ms |  1.47% |   2.834M |  52.227 GB/s |  5.60% |
|        1 |    8192 |        32 |            4 |       128 |   80.000 MiB |    64.000 MiB |          144 |   8192 |    704x |   5.445 ms |  8.10% |   5.411 ms |  0.96% |   1.514M |  27.903 GB/s |  2.99% |
|        1 |   16384 |        32 |            4 |       128 |  160.000 MiB |   128.000 MiB |          288 |  16384 |     24x |  20.868 ms |  0.40% |  20.860 ms |  0.40% | 785.424K |  14.477 GB/s |  1.55% |
|        1 |   32768 |        32 |            4 |       128 |  320.000 MiB |   256.000 MiB |          576 |  32768 |     11x |  83.461 ms |  0.47% |  83.452 ms |  0.47% | 392.658K |   7.237 GB/s |  0.78% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=2 head_size=128]
Pass: Cold: 0.059327ms GPU, 0.066550ms CPU, 0.50s total GPU, 0.96s total wall, 8432x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=2 head_size=128]
Pass: Cold: 0.138165ms GPU, 0.145385ms CPU, 0.50s total GPU, 0.68s total wall, 3632x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=2 head_size=128]
Pass: Cold: 0.414002ms GPU, 0.423985ms CPU, 0.62s total GPU, 0.70s total wall, 1504x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=2 head_size=128]
Pass: Cold: 1.442068ms GPU, 1.463379ms CPU, 1.34s total GPU, 1.40s total wall, 928x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=2 head_size=128]
Pass: Cold: 5.389185ms GPU, 5.410472ms CPU, 3.71s total GPU, 3.75s total wall, 688x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=2 head_size=128]
Pass: Cold: 20.811276ms GPU, 20.853814ms CPU, 12.99s total GPU, 13.04s total wall, 624x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=2 head_size=128]
Pass: Cold: 83.228163ms GPU, 83.238592ms CPU, 14.73s total GPU, 14.74s total wall, 177x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            2 |       128 |    4.500 MiB |     4.000 MiB |          8.5 |    512 |   8432x |  66.550 us | 35.08% |  59.327 us | 12.99% |   8.630M | 150.233 GB/s | 16.10% |
|        1 |    1024 |        32 |            2 |       128 |    9.000 MiB |     8.000 MiB |           17 |   1024 |   3632x | 145.385 us | 25.85% | 138.165 us |  3.16% |   7.411M | 129.018 GB/s | 13.83% |
|        1 |    2048 |        32 |            2 |       128 |   18.000 MiB |    16.000 MiB |           34 |   2048 |   1504x | 423.985 us | 20.50% | 414.002 us |  2.61% |   4.947M |  86.115 GB/s |  9.23% |
|        1 |    4096 |        32 |            2 |       128 |   36.000 MiB |    32.000 MiB |           68 |   4096 |    928x |   1.463 ms | 14.99% |   1.442 ms |  1.42% |   2.840M |  49.445 GB/s |  5.30% |
|        1 |    8192 |        32 |            2 |       128 |   72.000 MiB |    64.000 MiB |          136 |   8192 |    688x |   5.410 ms |  4.87% |   5.389 ms |  0.92% |   1.520M |  26.462 GB/s |  2.84% |
|        1 |   16384 |        32 |            2 |       128 |  144.000 MiB |   128.000 MiB |          272 |  16384 |    624x |  20.854 ms |  2.33% |  20.811 ms |  0.86% | 787.266K |  13.705 GB/s |  1.47% |
|        1 |   32768 |        32 |            2 |       128 |  288.000 MiB |   256.000 MiB |          544 |  32768 |    177x |  83.239 ms |  0.50% |  83.228 ms |  0.50% | 393.713K |   6.854 GB/s |  0.73% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=1 head_size=128]
Pass: Cold: 0.058903ms GPU, 0.065776ms CPU, 0.50s total GPU, 0.95s total wall, 8496x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=1 head_size=128]
Pass: Cold: 0.138319ms GPU, 0.146180ms CPU, 0.50s total GPU, 0.68s total wall, 3616x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=1 head_size=128]
Pass: Cold: 0.415405ms GPU, 0.425406ms CPU, 0.55s total GPU, 0.61s total wall, 1312x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=1 head_size=128]
Pass: Cold: 1.443569ms GPU, 1.462656ms CPU, 1.57s total GPU, 1.64s total wall, 1088x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=1 head_size=128]
Pass: Cold: 5.398271ms GPU, 5.458482ms CPU, 3.89s total GPU, 3.97s total wall, 720x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=1 head_size=128]
Pass: Cold: 20.897607ms GPU, 20.927935ms CPU, 12.37s total GPU, 12.42s total wall, 592x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=1 head_size=128]
Warn: Current measurement timed out (15.05s) while over noise threshold (0.66% > 0.50%)
Pass: Cold: 83.550561ms GPU, 83.560128ms CPU, 15.04s total GPU, 15.05s total wall, 180x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            1 |       128 |    4.250 MiB |     4.000 MiB |         8.25 |    512 |   8496x |  65.776 us | 16.99% |  58.903 us | 11.62% |   8.692M | 146.865 GB/s | 15.74% |
|        1 |    1024 |        32 |            1 |       128 |    8.500 MiB |     8.000 MiB |         16.5 |   1024 |   3616x | 146.180 us | 32.45% | 138.319 us |  3.13% |   7.403M | 125.084 GB/s | 13.40% |
|        1 |    2048 |        32 |            1 |       128 |   17.000 MiB |    16.000 MiB |           33 |   2048 |   1312x | 425.406 us | 19.20% | 415.405 us |  2.58% |   4.930M |  83.299 GB/s |  8.93% |
|        1 |    4096 |        32 |            1 |       128 |   34.000 MiB |    32.000 MiB |           66 |   4096 |   1088x |   1.463 ms | 15.13% |   1.444 ms |  1.61% |   2.837M |  47.941 GB/s |  5.14% |
|        1 |    8192 |        32 |            1 |       128 |   68.000 MiB |    64.000 MiB |          132 |   8192 |    720x |   5.458 ms | 11.98% |   5.398 ms |  1.33% |   1.518M |  25.640 GB/s |  2.75% |
|        1 |   16384 |        32 |            1 |       128 |  136.000 MiB |   128.000 MiB |          264 |  16384 |    592x |  20.928 ms |  1.98% |  20.898 ms |  0.87% | 784.013K |  13.247 GB/s |  1.42% |
|        1 |   32768 |        32 |            1 |       128 |  272.000 MiB |   256.000 MiB |          528 |  32768 |    180x |  83.560 ms |  0.66% |  83.551 ms |  0.66% | 392.194K |   6.627 GB/s |  0.71% |

# Head dimension tests
echo "Testing head dimension impact..."
Testing head dimension impact...
S=1 Hqo=32 Hkv=8 && for D in 56 64 80 96 128 160; do
  ./build/flash_attention_benchmark_standard \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
    --disable-blocking-kernel --md "results_standard/headdim-$D.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=56]
Pass: Cold: 0.045937ms GPU, 0.052930ms CPU, 0.50s total GPU, 1.10s total wall, 10896x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=56]
Pass: Cold: 0.103871ms GPU, 0.111874ms CPU, 0.50s total GPU, 0.74s total wall, 4816x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=56]
Pass: Cold: 0.297741ms GPU, 0.305716ms CPU, 0.50s total GPU, 0.58s total wall, 1680x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=56]
Pass: Cold: 1.029286ms GPU, 1.041783ms CPU, 3.13s total GPU, 3.30s total wall, 3040x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=56]
Pass: Cold: 3.808510ms GPU, 3.825945ms CPU, 3.41s total GPU, 3.47s total wall, 896x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=56]
Pass: Cold: 14.724156ms GPU, 14.731842ms CPU, 1.00s total GPU, 1.00s total wall, 68x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=56]
Pass: Cold: 58.863243ms GPU, 58.872210ms CPU, 0.65s total GPU, 0.65s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |        56 |    2.625 MiB |     1.750 MiB |        4.375 |    512 |  10896x |  52.930 us | 56.83% |  45.937 us | 54.41% |  11.146M |  99.865 GB/s | 10.70% |
|        1 |    1024 |        32 |            8 |        56 |    5.250 MiB |     3.500 MiB |         8.75 |   1024 |   4816x | 111.874 us | 43.84% | 103.871 us |  2.94% |   9.858M |  88.331 GB/s |  9.47% |
|        1 |    2048 |        32 |            8 |        56 |   10.500 MiB |     7.000 MiB |         17.5 |   2048 |   1680x | 305.716 us | 16.36% | 297.741 us |  1.81% |   6.878M |  61.631 GB/s |  6.60% |
|        1 |    4096 |        32 |            8 |        56 |   21.000 MiB |    14.000 MiB |           35 |   4096 |   3040x |   1.042 ms | 14.76% |   1.029 ms |  4.55% |   3.979M |  35.656 GB/s |  3.82% |
|        1 |    8192 |        32 |            8 |        56 |   42.000 MiB |    28.000 MiB |           70 |   8192 |    896x |   3.826 ms |  6.89% |   3.809 ms |  1.04% |   2.151M |  19.273 GB/s |  2.07% |
|        1 |   16384 |        32 |            8 |        56 |   84.000 MiB |    56.000 MiB |          140 |  16384 |     68x |  14.732 ms |  0.50% |  14.724 ms |  0.50% |   1.113M |   9.970 GB/s |  1.07% |
|        1 |   32768 |        32 |            8 |        56 |  168.000 MiB |   112.000 MiB |          280 |  32768 |     11x |  58.872 ms |  0.49% |  58.863 ms |  0.49% | 556.680K |   4.988 GB/s |  0.53% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=64]
Pass: Cold: 0.041107ms GPU, 0.048054ms CPU, 0.50s total GPU, 1.17s total wall, 12176x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=64]
Pass: Cold: 0.088254ms GPU, 0.095477ms CPU, 0.50s total GPU, 0.78s total wall, 5680x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=64]
Pass: Cold: 0.247583ms GPU, 0.255678ms CPU, 0.50s total GPU, 0.60s total wall, 2032x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=64]
Pass: Cold: 0.860034ms GPU, 0.872338ms CPU, 1.53s total GPU, 1.63s total wall, 1776x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=64]
Pass: Cold: 3.195673ms GPU, 3.212470ms CPU, 2.61s total GPU, 2.66s total wall, 816x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=64]
Pass: Cold: 12.305110ms GPU, 12.324660ms CPU, 9.65s total GPU, 9.70s total wall, 784x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=64]
Pass: Cold: 48.411287ms GPU, 48.419405ms CPU, 8.52s total GPU, 8.53s total wall, 176x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |        64 |    3.000 MiB |     2.000 MiB |            5 |    512 |  12176x |  48.054 us | 39.34% |  41.107 us | 16.19% |  12.455M | 127.543 GB/s | 13.67% |
|        1 |    1024 |        32 |            8 |        64 |    6.000 MiB |     4.000 MiB |           10 |   1024 |   5680x |  95.477 us | 44.75% |  88.254 us | 31.16% |  11.603M | 118.814 GB/s | 12.73% |
|        1 |    2048 |        32 |            8 |        64 |   12.000 MiB |     8.000 MiB |           20 |   2048 |   2032x | 255.678 us | 22.97% | 247.583 us |  2.40% |   8.272M |  84.705 GB/s |  9.08% |
|        1 |    4096 |        32 |            8 |        64 |   24.000 MiB |    16.000 MiB |           40 |   4096 |   1776x | 872.338 us | 11.58% | 860.034 us |  1.80% |   4.763M |  48.769 GB/s |  5.23% |
|        1 |    8192 |        32 |            8 |        64 |   48.000 MiB |    32.000 MiB |           80 |   8192 |    816x |   3.212 ms |  5.50% |   3.196 ms |  1.24% |   2.563M |  26.250 GB/s |  2.81% |
|        1 |   16384 |        32 |            8 |        64 |   96.000 MiB |    64.000 MiB |          160 |  16384 |    784x |  12.325 ms |  1.86% |  12.305 ms |  0.72% |   1.331M |  13.634 GB/s |  1.46% |
|        1 |   32768 |        32 |            8 |        64 |  192.000 MiB |   128.000 MiB |          320 |  32768 |    176x |  48.419 ms |  0.60% |  48.411 ms |  0.60% | 676.867K |   6.931 GB/s |  0.74% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=80]
Pass: Cold: 0.050881ms GPU, 0.058039ms CPU, 0.50s total GPU, 1.04s total wall, 9840x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=80]
Pass: Cold: 0.119550ms GPU, 0.126759ms CPU, 0.50s total GPU, 0.70s total wall, 4192x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=80]
Pass: Cold: 0.354807ms GPU, 0.362408ms CPU, 0.51s total GPU, 0.57s total wall, 1424x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=80]
Pass: Cold: 1.228977ms GPU, 1.239302ms CPU, 1.22s total GPU, 1.27s total wall, 992x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=80]
Pass: Cold: 4.598393ms GPU, 4.612907ms CPU, 2.65s total GPU, 2.68s total wall, 576x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=80]
Pass: Cold: 17.784689ms GPU, 17.794978ms CPU, 9.39s total GPU, 9.42s total wall, 528x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=80]
Pass: Cold: 71.574805ms GPU, 71.593568ms CPU, 6.87s total GPU, 6.88s total wall, 96x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |        80 |    3.750 MiB |     2.500 MiB |         6.25 |    512 |   9840x |  58.039 us | 55.05% |  50.881 us | 12.12% |  10.063M | 128.802 GB/s | 13.80% |
|        1 |    1024 |        32 |            8 |        80 |    7.500 MiB |     5.000 MiB |         12.5 |   1024 |   4192x | 126.759 us | 22.44% | 119.550 us |  3.30% |   8.565M | 109.638 GB/s | 11.75% |
|        1 |    2048 |        32 |            8 |        80 |   15.000 MiB |    10.000 MiB |           25 |   2048 |   1424x | 362.408 us |  9.06% | 354.807 us |  2.45% |   5.772M |  73.883 GB/s |  7.92% |
|        1 |    4096 |        32 |            8 |        80 |   30.000 MiB |    20.000 MiB |           50 |   4096 |    992x |   1.239 ms |  4.96% |   1.229 ms |  1.55% |   3.333M |  42.661 GB/s |  4.57% |
|        1 |    8192 |        32 |            8 |        80 |   60.000 MiB |    40.000 MiB |          100 |   8192 |    576x |   4.613 ms |  3.09% |   4.598 ms |  0.87% |   1.781M |  22.803 GB/s |  2.44% |
|        1 |   16384 |        32 |            8 |        80 |  120.000 MiB |    80.000 MiB |          200 |  16384 |    528x |  17.795 ms |  0.78% |  17.785 ms |  0.70% | 921.242K |  11.792 GB/s |  1.26% |
|        1 |   32768 |        32 |            8 |        80 |  240.000 MiB |   160.000 MiB |          400 |  32768 |     96x |  71.594 ms |  0.75% |  71.575 ms |  0.74% | 457.815K |   5.860 GB/s |  0.63% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=96]
Pass: Cold: 0.049875ms GPU, 0.057445ms CPU, 0.50s total GPU, 1.05s total wall, 10032x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=96]
Pass: Cold: 0.114397ms GPU, 0.121321ms CPU, 0.50s total GPU, 0.71s total wall, 4384x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=96]
Pass: Cold: 0.338165ms GPU, 0.346648ms CPU, 0.54s total GPU, 0.62s total wall, 1600x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=96]
Pass: Cold: 1.176721ms GPU, 1.186935ms CPU, 1.32s total GPU, 1.38s total wall, 1120x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=96]
Pass: Cold: 4.389493ms GPU, 4.407795ms CPU, 4.85s total GPU, 4.92s total wall, 1104x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=96]
Pass: Cold: 17.015907ms GPU, 17.047786ms CPU, 0.53s total GPU, 0.53s total wall, 31x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=96]
Warn: Current measurement timed out (15.02s) while over noise threshold (0.67% > 0.50%)
Pass: Cold: 68.482525ms GPU, 68.526977ms CPU, 15.00s total GPU, 15.02s total wall, 219x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |        96 |    4.500 MiB |     3.000 MiB |          7.5 |    512 |  10032x |  57.445 us | 42.88% |  49.875 us | 13.04% |  10.266M | 157.680 GB/s | 16.90% |
|        1 |    1024 |        32 |            8 |        96 |    9.000 MiB |     6.000 MiB |           15 |   1024 |   4384x | 121.321 us | 12.48% | 114.397 us |  3.17% |   8.951M | 137.492 GB/s | 14.73% |
|        1 |    2048 |        32 |            8 |        96 |   18.000 MiB |    12.000 MiB |           30 |   2048 |   1600x | 346.648 us | 11.59% | 338.165 us |  2.71% |   6.056M |  93.023 GB/s |  9.97% |
|        1 |    4096 |        32 |            8 |        96 |   36.000 MiB |    24.000 MiB |           60 |   4096 |   1120x |   1.187 ms |  5.56% |   1.177 ms |  1.45% |   3.481M |  53.466 GB/s |  5.73% |
|        1 |    8192 |        32 |            8 |        96 |   72.000 MiB |    48.000 MiB |          120 |   8192 |   1104x |   4.408 ms |  5.52% |   4.389 ms |  1.03% |   1.866M |  28.666 GB/s |  3.07% |
|        1 |   16384 |        32 |            8 |        96 |  144.000 MiB |    96.000 MiB |          240 |  16384 |     31x |  17.048 ms |  0.99% |  17.016 ms |  0.50% | 962.864K |  14.790 GB/s |  1.58% |
|        1 |   32768 |        32 |            8 |        96 |  288.000 MiB |   192.000 MiB |          480 |  32768 |    219x |  68.527 ms |  1.00% |  68.483 ms |  0.67% | 478.487K |   7.350 GB/s |  0.79% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.060152ms GPU, 0.067370ms CPU, 0.50s total GPU, 0.95s total wall, 8320x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.140013ms GPU, 0.147790ms CPU, 0.50s total GPU, 0.68s total wall, 3584x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.421598ms GPU, 0.431676ms CPU, 0.64s total GPU, 0.72s total wall, 1520x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 1.459924ms GPU, 1.473852ms CPU, 1.92s total GPU, 1.99s total wall, 1312x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 5.454955ms GPU, 5.471621ms CPU, 4.89s total GPU, 4.94s total wall, 896x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 21.132843ms GPU, 21.161746ms CPU, 11.16s total GPU, 11.20s total wall, 528x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 84.574953ms GPU, 84.584185ms CPU, 0.93s total GPU, 0.93s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |       128 |    6.000 MiB |     4.000 MiB |           10 |    512 |   8320x |  67.370 us | 19.60% |  60.152 us | 13.55% |   8.512M | 174.322 GB/s | 18.68% |
|        1 |    1024 |        32 |            8 |       128 |   12.000 MiB |     8.000 MiB |           20 |   1024 |   3584x | 147.790 us | 30.96% | 140.013 us |  3.05% |   7.314M | 149.782 GB/s | 16.05% |
|        1 |    2048 |        32 |            8 |       128 |   24.000 MiB |    16.000 MiB |           40 |   2048 |   1520x | 431.676 us | 17.32% | 421.598 us |  2.99% |   4.858M |  99.486 GB/s | 10.66% |
|        1 |    4096 |        32 |            8 |       128 |   48.000 MiB |    32.000 MiB |           80 |   4096 |   1312x |   1.474 ms |  8.22% |   1.460 ms |  1.54% |   2.806M |  57.459 GB/s |  6.16% |
|        1 |    8192 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |    896x |   5.472 ms |  4.82% |   5.455 ms |  0.84% |   1.502M |  30.756 GB/s |  3.30% |
|        1 |   16384 |        32 |            8 |       128 |  192.000 MiB |   128.000 MiB |          320 |  16384 |    528x |  21.162 ms |  2.27% |  21.133 ms |  0.96% | 775.286K |  15.878 GB/s |  1.70% |
|        1 |   32768 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |     11x |  84.584 ms |  0.38% |  84.575 ms |  0.38% | 387.443K |   7.935 GB/s |  0.85% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=160]
Pass: Cold: 0.073717ms GPU, 0.081319ms CPU, 0.50s total GPU, 0.86s total wall, 6784x 
Run:  [2/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=160]
Pass: Cold: 0.182843ms GPU, 0.189780ms CPU, 0.50s total GPU, 0.63s total wall, 2736x 
Run:  [3/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=160]
Pass: Cold: 0.561575ms GPU, 0.570705ms CPU, 0.78s total GPU, 0.85s total wall, 1392x 
Run:  [4/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=160]
Pass: Cold: 1.964668ms GPU, 1.979349ms CPU, 1.60s total GPU, 1.65s total wall, 816x 
Run:  [5/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=160]
Pass: Cold: 7.379705ms GPU, 7.409980ms CPU, 5.55s total GPU, 5.61s total wall, 752x 
Run:  [6/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=160]
Warn: Current measurement timed out (15.02s) while over noise threshold (0.78% > 0.50%)
Pass: Cold: 29.087603ms GPU, 29.109010ms CPU, 14.98s total GPU, 15.02s total wall, 515x 
Run:  [7/7] run_mha_fwd [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=160]
Pass: Cold: 119.113354ms GPU, 119.122615ms CPU, 1.31s total GPU, 1.31s total wall, 11x 
```

# Benchmark Results

## run_mha_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|----------|--------------|--------|
|        1 |     512 |        32 |            8 |       160 |    7.500 MiB |     5.000 MiB |         12.5 |    512 |   6784x |  81.319 us | 48.93% |  73.717 us | 13.17% |   6.945M | 177.803 GB/s | 19.05% |
|        1 |    1024 |        32 |            8 |       160 |   15.000 MiB |    10.000 MiB |           25 |   1024 |   2736x | 189.780 us |  5.46% | 182.843 us |  3.47% |   5.600M | 143.371 GB/s | 15.36% |
|        1 |    2048 |        32 |            8 |       160 |   30.000 MiB |    20.000 MiB |           50 |   2048 |   1392x | 570.705 us | 10.81% | 561.575 us |  2.74% |   3.647M |  93.360 GB/s | 10.01% |
|        1 |    4096 |        32 |            8 |       160 |   60.000 MiB |    40.000 MiB |          100 |   4096 |    816x |   1.979 ms |  6.17% |   1.965 ms |  1.40% |   2.085M |  53.372 GB/s |  5.72% |
|        1 |    8192 |        32 |            8 |       160 |  120.000 MiB |    80.000 MiB |          200 |   8192 |    752x |   7.410 ms |  4.89% |   7.380 ms |  1.00% |   1.110M |  28.418 GB/s |  3.05% |
|        1 |   16384 |        32 |            8 |       160 |  240.000 MiB |   160.000 MiB |          400 |  16384 |    515x |  29.109 ms |  1.27% |  29.088 ms |  0.78% | 563.264K |  14.420 GB/s |  1.55% |
|        1 |   32768 |        32 |            8 |       160 |  480.000 MiB |   320.000 MiB |          800 |  32768 |     11x | 119.123 ms |  0.44% | 119.113 ms |  0.44% | 275.099K |   7.043 GB/s |  0.75% |

# =====================================================
# VARIABLE LENGTH ATTENTION BENCHMARKS
# =====================================================

echo "===== VARIABLE LENGTH ATTENTION BENCHMARKS ====="
===== VARIABLE LENGTH ATTENTION BENCHMARKS =====

# Modern LLM configs with variable sequence lengths
echo "Testing variable length sequences..."
Testing variable length sequences...

# Mix of short and long sequences (GPT-2 to DeepSeek range)
S=16 Hqo=32 Hkv=8 D=128 && ./build/flash_attention_benchmark_varlen \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  -a seq_len=2048 --disable-blocking-kernel --md "results_varlen/typical-mix.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=16 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.00s) while over noise threshold (3.19% > 0.50%)
Pass: Cold: 6.398271ms GPU, 6.414720ms CPU, 14.85s total GPU, 15.00s total wall, 2321x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time | Noise | GPU Time | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|----------|-------|----------|-------|--------|--------------|--------|
|       16 |    2048 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |   2321x | 6.415 ms | 4.50% | 6.398 ms | 3.19% | 5.121M | 104.886 GB/s | 11.24% |

# GQA ratio impact for variable-length sequences
echo "Testing GQA ratio impact with variable length..."
Testing GQA ratio impact with variable length...
S=16 D=128 && for R in 1 4 8; do
  Hqo=32 Hkv=$((Hqo / R))
  ./build/flash_attention_benchmark_varlen \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
    -a seq_len=4096 --disable-blocking-kernel --md "results_varlen/gqa-$R.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=32 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (2.98% > 0.50%)
Pass: Cold: 23.174921ms GPU, 23.183526ms CPU, 14.97s total GPU, 15.01s total wall, 646x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|       16 |    4096 |        32 |           32 |       128 |    1.500 GiB |   512.000 MiB |         2048 |  65536 |    646x | 23.184 ms | 2.98% | 23.175 ms | 2.98% | 2.828M |  92.664 GB/s |  9.93% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (2.57% > 0.50%)
Pass: Cold: 23.065849ms GPU, 23.081448ms CPU, 14.97s total GPU, 15.01s total wall, 649x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|       16 |    4096 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |  65536 |    649x | 23.081 ms | 2.71% | 23.066 ms | 2.57% | 2.841M |  58.189 GB/s |  6.24% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=4 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (2.15% > 0.50%)
Pass: Cold: 22.957045ms GPU, 22.968594ms CPU, 14.97s total GPU, 15.01s total wall, 652x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|       16 |    4096 |        32 |            4 |       128 |  640.000 MiB |   512.000 MiB |         1152 |  65536 |    652x | 22.969 ms | 2.16% | 22.957 ms | 2.15% | 2.855M |  52.618 GB/s |  5.64% |

# Head dimension impact for variable-length sequences
echo "Testing head dimension impact with variable length..."
Testing head dimension impact with variable length...
S=16 Hqo=32 Hkv=8 && for D in 64 96 128; do
  ./build/flash_attention_benchmark_varlen \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
    -a seq_len=4096 --disable-blocking-kernel --md "results_varlen/headdim-$D.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=64]
Warn: Current measurement timed out (15.01s) while over noise threshold (2.22% > 0.50%)
Pass: Cold: 13.409140ms GPU, 13.437780ms CPU, 14.92s total GPU, 15.01s total wall, 1113x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|       16 |    4096 |        32 |            8 |        64 |  384.000 MiB |   256.000 MiB |          640 |  65536 |   1113x | 13.438 ms | 3.31% | 13.409 ms | 2.22% | 4.887M |  50.047 GB/s |  5.36% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=96]
Warn: Current measurement timed out (15.00s) while over noise threshold (3.14% > 0.50%)
Pass: Cold: 17.936858ms GPU, 17.963169ms CPU, 14.94s total GPU, 15.00s total wall, 833x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|       16 |    4096 |        32 |            8 |        96 |  576.000 MiB |   384.000 MiB |          960 |  65536 |    833x | 17.963 ms | 3.62% | 17.937 ms | 3.14% | 3.654M |  56.121 GB/s |  6.01% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (2.62% > 0.50%)
Pass: Cold: 23.033454ms GPU, 23.042161ms CPU, 14.97s total GPU, 15.01s total wall, 650x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|       16 |    4096 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |  65536 |    650x | 23.042 ms | 2.62% | 23.033 ms | 2.62% | 2.845M |  58.271 GB/s |  6.24% |

# Sequence length scaling
echo "Testing sequence length scaling with variable length..."
Testing sequence length scaling with variable length...
S=8 Hqo=32 Hkv=8 D=128 && for L in 1024 4096 8192 16384 32768; do
  ./build/flash_attention_benchmark_varlen \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
    -a seq_len=$L --disable-blocking-kernel --md "results_varlen/seqlen-$L.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=8 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 0.932406ms GPU, 0.943654ms CPU, 2.64s total GPU, 2.80s total wall, 2832x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|-------|--------|--------------|--------|
|        8 |    1024 |        32 |            8 |       128 |   96.000 MiB |    64.000 MiB |          160 |   8192 |   2832x | 943.654 us | 11.76% | 932.406 us | 6.72% | 8.786M | 179.935 GB/s | 19.28% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=8 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.01s) while over noise threshold (3.34% > 0.50%)
Pass: Cold: 11.553134ms GPU, 11.576839ms CPU, 14.92s total GPU, 15.01s total wall, 1291x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|        8 |    4096 |        32 |            8 |       128 |  384.000 MiB |   256.000 MiB |          640 |  32768 |   1291x | 11.577 ms | 4.26% | 11.553 ms | 3.34% | 2.836M |  58.087 GB/s |  6.23% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=8 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.04s) while over noise threshold (2.92% > 0.50%)
Pass: Cold: 43.639537ms GPU, 43.669741ms CPU, 15.01s total GPU, 15.04s total wall, 344x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise | GPU Time  | Noise | Elem/s | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|-----------|-------|-----------|-------|--------|--------------|--------|
|        8 |    8192 |        32 |            8 |       128 |  768.000 MiB |   512.000 MiB |         1280 |  65536 |    344x | 43.670 ms | 3.07% | 43.640 ms | 2.92% | 1.502M |  30.756 GB/s |  3.30% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=8 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128]
Warn: Current measurement timed out (15.00s) while over noise threshold (0.78% > 0.50%)
Pass: Cold: 170.343982ms GPU, 170.449802ms CPU, 14.99s total GPU, 15.00s total wall, 88x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise |  GPU Time  | Noise |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|-------|------------|-------|----------|--------------|--------|
|        8 |   16384 |        32 |            8 |       128 |    1.500 GiB |     1.000 GiB |         2560 | 131072 |     88x | 170.450 ms | 0.95% | 170.344 ms | 0.78% | 769.455K |  15.758 GB/s |  1.69% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=8 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128]
Pass: Cold: 685.027704ms GPU, 685.047728ms CPU, 7.54s total GPU, 7.54s total wall, 11x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise |  GPU Time  | Noise |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|-------|------------|-------|----------|--------------|--------|
|        8 |   32768 |        32 |            8 |       128 |    3.000 GiB |     2.000 GiB |         5120 | 262144 |     11x | 685.048 ms | 0.10% | 685.028 ms | 0.10% | 382.676K |   7.837 GB/s |  0.84% |

# Extreme test case for DeepSeek-like models
S=1 Hqo=128 Hkv=128 D=56 && ./build/flash_attention_benchmark_varlen \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D \
  -a seq_len=65536 --disable-blocking-kernel --md "results_varlen/deepseek-extreme.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd [Device=0 num_seqs=1 seq_len=65536 num_heads=128 num_kv_heads=128 head_size=56]
Pass: Cold: 991.892384ms GPU, 991.927624ms CPU, 10.91s total GPU, 10.91s total wall, 11x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise |  GPU Time  | Noise | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|--------------|---------------|--------------|--------|---------|------------|-------|------------|-------|---------|--------------|--------|
|        1 |   65536 |       128 |          128 |        56 |    2.625 GiB |   896.000 MiB |         3584 |  65536 |     11x | 991.928 ms | 0.14% | 991.892 ms | 0.14% | 66.072K |   3.789 GB/s |  0.41% |

# =====================================================
# KV CACHE ATTENTION BENCHMARKS
# =====================================================

echo "===== KV CACHE ATTENTION BENCHMARKS ====="
===== KV CACHE ATTENTION BENCHMARKS =====

# Modern LLM model configurations with KV caching
echo "Testing modern LLM configurations with KV cache..."
Testing modern LLM configurations with KV cache...

# Qwen 2.5 configuration
S=1 Hqo=40 Hkv=8 D=128 P=256 && ./build/flash_attention_benchmark_kvcache \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
  --disable-blocking-kernel --md "results_kvcache/qwen2.5-32b.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.027563ms GPU, 0.034573ms CPU, 0.50s total GPU, 1.56s total wall, 18144x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026615ms GPU, 0.033827ms CPU, 0.50s total GPU, 1.57s total wall, 18800x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026732ms GPU, 0.033571ms CPU, 0.50s total GPU, 1.57s total wall, 18720x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.029900ms GPU, 0.036847ms CPU, 0.50s total GPU, 1.43s total wall, 16736x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.035500ms GPU, 0.042355ms CPU, 0.50s total GPU, 1.26s total wall, 14096x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.046410ms GPU, 0.054418ms CPU, 0.50s total GPU, 1.08s total wall, 10784x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.068771ms GPU, 0.075605ms CPU, 0.50s total GPU, 0.86s total wall, 7280x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.115324ms GPU, 0.122494ms CPU, 0.50s total GPU, 0.71s total wall, 4336x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.205954ms GPU, 0.213398ms CPU, 0.50s total GPU, 0.62s total wall, 2432x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.381624ms GPU, 0.389880ms CPU, 0.50s total GPU, 0.56s total wall, 1311x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=40 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.733025ms GPU, 0.739937ms CPU, 0.50s total GPU, 0.53s total wall, 683x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|---------|--------------|--------|
|        1 |      32 |        40 |            8 |       128 |       256 |  138.000 KiB |    10.000 KiB |         4096 |     32 |  18144x |  34.573 us |  28.98% |  27.563 us | 12.91% |  1.161M |   5.498 GB/s |  0.59% |
|        1 |      64 |        40 |            8 |       128 |       256 |  266.000 KiB |    10.000 KiB |         4096 |     64 |  18800x |  33.827 us | 115.86% |  26.615 us |  2.79% |  2.405M |  10.619 GB/s |  1.14% |
|        1 |     128 |        40 |            8 |       128 |       256 |  522.000 KiB |    10.000 KiB |         4096 |    128 |  18720x |  33.571 us |  25.80% |  26.732 us |  3.77% |  4.788M |  20.379 GB/s |  2.18% |
|        1 |     256 |        40 |            8 |       128 |       256 |    1.010 MiB |    10.000 KiB |         4096 |    256 |  16736x |  36.847 us |  44.18% |  29.900 us |  3.17% |  8.562M |  35.755 GB/s |  3.83% |
|        1 |     512 |        40 |            8 |       128 |       256 |    2.010 MiB |    10.000 KiB |         4096 |    512 |  14096x |  42.355 us |  47.55% |  35.500 us | 43.45% | 14.422M |  59.651 GB/s |  6.39% |
|        1 |    1024 |        40 |            8 |       128 |       256 |    4.010 MiB |    10.000 KiB |         4096 |   1024 |  10784x |  54.418 us | 213.02% |  46.410 us |  2.26% | 22.064M |  90.816 GB/s |  9.73% |
|        1 |    2048 |        40 |            8 |       128 |       256 |    8.010 MiB |    10.000 KiB |         4096 |   2048 |   7280x |  75.605 us |   9.98% |  68.771 us |  1.16% | 29.780M | 122.277 GB/s | 13.10% |
|        1 |    4096 |        40 |            8 |       128 |       256 |   16.010 MiB |    10.000 KiB |         4096 |   4096 |   4336x | 122.494 us |  18.55% | 115.324 us |  0.70% | 35.517M | 145.657 GB/s | 15.61% |
|        1 |    8192 |        40 |            8 |       128 |       256 |   32.010 MiB |    10.000 KiB |         4096 |   8192 |   2432x | 213.398 us |  14.64% | 205.954 us |  0.57% | 39.776M | 163.021 GB/s | 17.47% |
|        1 |   16384 |        40 |            8 |       128 |       256 |   64.010 MiB |    10.000 KiB |         4096 |  16384 |   1311x | 389.880 us |  13.68% | 381.624 us |  0.25% | 42.932M | 175.904 GB/s | 18.85% |
|        1 |   32768 |        40 |            8 |       128 |       256 |  128.010 MiB |    10.000 KiB |         4096 |  32768 |    683x | 739.937 us |   0.95% | 733.025 us |  0.14% | 44.702M | 183.129 GB/s | 19.63% |

# Phi-4 configuration
S=1 Hqo=40 Hkv=10 D=128 P=256 && ./build/flash_attention_benchmark_kvcache \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
  --disable-blocking-kernel --md "results_kvcache/phi4.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.027885ms GPU, 0.034941ms CPU, 0.50s total GPU, 1.56s total wall, 17936x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.027104ms GPU, 0.033925ms CPU, 0.50s total GPU, 1.56s total wall, 18448x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.027165ms GPU, 0.034083ms CPU, 0.51s total GPU, 1.59s total wall, 18688x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.030204ms GPU, 0.037183ms CPU, 0.50s total GPU, 1.46s total wall, 16560x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.035840ms GPU, 0.042773ms CPU, 0.50s total GPU, 1.27s total wall, 13952x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.047299ms GPU, 0.054118ms CPU, 0.50s total GPU, 1.06s total wall, 10576x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.070067ms GPU, 0.078525ms CPU, 0.50s total GPU, 0.87s total wall, 7152x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.118695ms GPU, 0.125488ms CPU, 0.51s total GPU, 0.72s total wall, 4320x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.207702ms GPU, 0.215223ms CPU, 0.50s total GPU, 0.62s total wall, 2416x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.384308ms GPU, 0.391106ms CPU, 0.50s total GPU, 0.56s total wall, 1302x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=40 num_kv_heads=10 head_size=128 page_size=256]
Pass: Cold: 0.736565ms GPU, 0.745051ms CPU, 0.50s total GPU, 0.53s total wall, 679x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|---------|--------------|--------|
|        1 |      32 |        40 |           10 |       128 |       256 |  170.000 KiB |    10.000 KiB |         5120 |     32 |  17936x |  34.941 us |  84.36% |  27.885 us | 79.13% |  1.148M |   6.610 GB/s |  0.71% |
|        1 |      64 |        40 |           10 |       128 |       256 |  330.000 KiB |    10.000 KiB |         5120 |     64 |  18448x |  33.925 us |  66.58% |  27.104 us | 61.48% |  2.361M |  12.845 GB/s |  1.38% |
|        1 |     128 |        40 |           10 |       128 |       256 |  650.000 KiB |    10.000 KiB |         5120 |    128 |  18688x |  34.083 us |  78.23% |  27.165 us | 47.79% |  4.712M |  24.879 GB/s |  2.67% |
|        1 |     256 |        40 |           10 |       128 |       256 |    1.260 MiB |    10.000 KiB |         5120 |    256 |  16560x |  37.183 us |  47.21% |  30.204 us |  2.94% |  8.476M |  44.073 GB/s |  4.72% |
|        1 |     512 |        40 |           10 |       128 |       256 |    2.510 MiB |    10.000 KiB |         5120 |    512 |  13952x |  42.773 us |  46.02% |  35.840 us |  2.56% | 14.286M |  73.715 GB/s |  7.90% |
|        1 |    1024 |        40 |           10 |       128 |       256 |    5.010 MiB |    10.000 KiB |         5120 |   1024 |  10576x |  54.118 us |  37.08% |  47.299 us | 34.17% | 21.649M | 111.278 GB/s | 11.93% |
|        1 |    2048 |        40 |           10 |       128 |       256 |   10.010 MiB |    10.000 KiB |         5120 |   2048 |   7152x |  78.525 us | 172.36% |  70.067 us |  1.44% | 29.229M | 149.946 GB/s | 16.07% |
|        1 |    4096 |        40 |           10 |       128 |       256 |   20.010 MiB |    10.000 KiB |         5120 |   4096 |   4320x | 125.488 us |   5.79% | 118.695 us |  0.97% | 34.509M | 176.856 GB/s | 18.95% |
|        1 |    8192 |        40 |           10 |       128 |       256 |   40.010 MiB |    10.000 KiB |         5120 |   8192 |   2416x | 215.223 us |  16.14% | 207.702 us |  0.51% | 39.441M | 202.037 GB/s | 21.65% |
|        1 |   16384 |        40 |           10 |       128 |       256 |   80.010 MiB |    10.000 KiB |         5120 |  16384 |   1302x | 391.106 us |   1.79% | 384.308 us |  0.28% | 42.633M | 218.332 GB/s | 23.40% |
|        1 |   32768 |        40 |           10 |       128 |       256 |  160.010 MiB |    10.000 KiB |         5120 |  32768 |    679x | 745.051 us |   5.94% | 736.565 us |  0.16% | 44.488M | 227.804 GB/s | 24.41% |

# Mixtral configuration
S=1 Hqo=32 Hkv=8 D=128 P=256 && ./build/flash_attention_benchmark_kvcache \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
  --disable-blocking-kernel --md "results_kvcache/mixtral-7b.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026980ms GPU, 0.034209ms CPU, 0.50s total GPU, 1.58s total wall, 18544x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026095ms GPU, 0.033031ms CPU, 0.50s total GPU, 1.59s total wall, 19168x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026177ms GPU, 0.033159ms CPU, 0.50s total GPU, 1.60s total wall, 19104x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.029490ms GPU, 0.036294ms CPU, 0.50s total GPU, 1.44s total wall, 16960x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.034864ms GPU, 0.041793ms CPU, 0.50s total GPU, 1.28s total wall, 14352x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.045957ms GPU, 0.052994ms CPU, 0.50s total GPU, 1.08s total wall, 10880x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.068355ms GPU, 0.075163ms CPU, 0.50s total GPU, 0.86s total wall, 7328x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.115452ms GPU, 0.122657ms CPU, 0.50s total GPU, 0.71s total wall, 4336x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.205510ms GPU, 0.213003ms CPU, 0.50s total GPU, 0.61s total wall, 2433x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.381147ms GPU, 0.388818ms CPU, 0.50s total GPU, 0.56s total wall, 1312x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.733140ms GPU, 0.742076ms CPU, 0.50s total GPU, 0.53s total wall, 682x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|---------|--------------|--------|
|        1 |      32 |        32 |            8 |       128 |       256 |  136.000 KiB |     8.000 KiB |         4096 |     32 |  18544x |  34.209 us | 120.58% |  26.980 us | 67.37% |  1.186M |   5.465 GB/s |  0.59% |
|        1 |      64 |        32 |            8 |       128 |       256 |  264.000 KiB |     8.000 KiB |         4096 |     64 |  19168x |  33.031 us |  59.58% |  26.095 us |  2.93% |  2.453M |  10.674 GB/s |  1.14% |
|        1 |     128 |        32 |            8 |       128 |       256 |  520.000 KiB |     8.000 KiB |         4096 |    128 |  19104x |  33.159 us |  83.78% |  26.177 us |  3.34% |  4.890M |  20.655 GB/s |  2.21% |
|        1 |     256 |        32 |            8 |       128 |       256 |    1.008 MiB |     8.000 KiB |         4096 |    256 |  16960x |  36.294 us |  52.05% |  29.490 us | 46.65% |  8.681M |  36.112 GB/s |  3.87% |
|        1 |     512 |        32 |            8 |       128 |       256 |    2.008 MiB |     8.000 KiB |         4096 |    512 |  14352x |  41.793 us |  48.02% |  34.864 us |  2.08% | 14.686M |  60.622 GB/s |  6.50% |
|        1 |    1024 |        32 |            8 |       128 |       256 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10880x |  52.994 us |  18.16% |  45.957 us |  2.49% | 22.282M |  91.622 GB/s |  9.82% |
|        1 |    2048 |        32 |            8 |       128 |       256 |    8.008 MiB |     8.000 KiB |         4096 |   2048 |   7328x |  75.163 us |  10.00% |  68.355 us |  1.09% | 29.961M | 122.961 GB/s | 13.18% |
|        1 |    4096 |        32 |            8 |       128 |       256 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   4336x | 122.657 us |  23.31% | 115.452 us |  0.71% | 35.478M | 145.460 GB/s | 15.59% |
|        1 |    8192 |        32 |            8 |       128 |       256 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2433x | 213.003 us |  17.32% | 205.510 us |  0.44% | 39.862M | 163.354 GB/s | 17.51% |
|        1 |   16384 |        32 |            8 |       128 |       256 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   1312x | 388.818 us |   8.71% | 381.147 us |  0.25% | 42.986M | 176.114 GB/s | 18.87% |
|        1 |   32768 |        32 |            8 |       128 |       256 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |    682x | 742.076 us |   7.63% | 733.140 us |  0.15% | 44.695M | 183.095 GB/s | 19.62% |

# DeepSeek configuration (with larger page size to handle the extreme context)
S=1 Hqo=128 Hkv=128 D=56 P=1024 && ./build/flash_attention_benchmark_kvcache \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
  --disable-blocking-kernel --md "results_kvcache/deepseek-r1.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=128 num_kv_heads=128 head_size=56 page_size=1024]
Skip: OOM: 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

No data -- check log.

# Legacy model configurations
echo "Testing legacy model configurations with KV cache..."
Testing legacy model configurations with KV cache...

# Llama 2 7B-like
S=1 Hqo=32 Hkv=32 D=128 P=256 && ./build/flash_attention_benchmark_kvcache \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
  --disable-blocking-kernel --md "results_kvcache/llama2-7b.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.024842ms GPU, 0.032087ms CPU, 0.50s total GPU, 1.84s total wall, 20128x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.024779ms GPU, 0.031803ms CPU, 0.50s total GPU, 1.79s total wall, 20192x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.026905ms GPU, 0.034634ms CPU, 0.50s total GPU, 1.70s total wall, 18592x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.030575ms GPU, 0.038024ms CPU, 0.50s total GPU, 1.53s total wall, 16368x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.037932ms GPU, 0.045654ms CPU, 0.50s total GPU, 1.29s total wall, 13184x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.055601ms GPU, 0.062518ms CPU, 0.50s total GPU, 1.00s total wall, 9008x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.083173ms GPU, 0.091282ms CPU, 0.50s total GPU, 0.84s total wall, 6016x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.129297ms GPU, 0.138624ms CPU, 0.50s total GPU, 0.73s total wall, 3872x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.219803ms GPU, 0.228816ms CPU, 0.50s total GPU, 0.63s total wall, 2288x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.401826ms GPU, 0.417669ms CPU, 1.29s total GPU, 1.50s total wall, 3216x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.764822ms GPU, 0.776339ms CPU, 0.50s total GPU, 0.54s total wall, 654x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  |  Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|---------|---------|--------------|--------|
|        1 |      32 |        32 |           32 |       128 |       256 |  520.000 KiB |     8.000 KiB |        16384 |     32 |  20128x |  32.087 us | 122.26% |  24.842 us |   9.18% |  1.288M |  21.764 GB/s |  2.33% |
|        1 |      64 |        32 |           32 |       128 |       256 |    1.008 MiB |     8.000 KiB |        16384 |     64 |  20192x |  31.803 us | 124.01% |  24.779 us |  62.49% |  2.583M |  42.979 GB/s |  4.61% |
|        1 |     128 |        32 |           32 |       128 |       256 |    2.008 MiB |     8.000 KiB |        16384 |    128 |  18592x |  34.634 us | 417.21% |  26.905 us | 281.27% |  4.758M |  78.556 GB/s |  8.42% |
|        1 |     256 |        32 |           32 |       128 |       256 |    4.008 MiB |     8.000 KiB |        16384 |    256 |  16368x |  38.024 us | 262.39% |  30.575 us |   4.56% |  8.373M | 137.718 GB/s | 14.76% |
|        1 |     512 |        32 |           32 |       128 |       256 |    8.008 MiB |     8.000 KiB |        16384 |    512 |  13184x |  45.654 us | 251.40% |  37.932 us |   4.28% | 13.498M | 221.580 GB/s | 23.75% |
|        1 |    1024 |        32 |           32 |       128 |       256 |   16.008 MiB |     8.000 KiB |        16384 |   1024 |   9008x |  62.518 us |  65.76% |  55.601 us |  52.26% | 18.417M | 302.037 GB/s | 32.37% |
|        1 |    2048 |        32 |           32 |       128 |       256 |   32.008 MiB |     8.000 KiB |        16384 |   2048 |   6016x |  91.282 us | 146.35% |  83.173 us |   4.44% | 24.623M | 403.628 GB/s | 43.26% |
|        1 |    4096 |        32 |           32 |       128 |       256 |   64.008 MiB |     8.000 KiB |        16384 |   4096 |   3872x | 138.624 us |  44.78% | 129.297 us |   1.55% | 31.679M | 519.154 GB/s | 55.64% |
|        1 |    8192 |        32 |           32 |       128 |       256 |  128.008 MiB |     8.000 KiB |        16384 |   8192 |   2288x | 228.816 us |  28.32% | 219.803 us |   0.68% | 37.270M | 610.702 GB/s | 65.45% |
|        1 |   16384 |        32 |           32 |       128 |       256 |  256.008 MiB |     8.000 KiB |        16384 |  16384 |   3216x | 417.669 us |  64.59% | 401.826 us |   7.70% | 40.774M | 668.079 GB/s | 71.60% |
|        1 |   32768 |        32 |           32 |       128 |       256 |  512.008 MiB |     8.000 KiB |        16384 |  32768 |    654x | 776.339 us |  11.42% | 764.822 us |   0.31% | 42.844M | 701.977 GB/s | 75.23% |

# Batch size scaling tests
echo "Testing batch size scaling with KV cache..."
Testing batch size scaling with KV cache...
for S in 1 2 4 8 16 32; do
  Hqo=32 Hkv=8 D=128 P=256 && ./build/flash_attention_benchmark_kvcache \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
    --disable-blocking-kernel --md "results_kvcache/batch-scaling-$S.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.027717ms GPU, 0.034999ms CPU, 0.50s total GPU, 1.58s total wall, 18048x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026400ms GPU, 0.033304ms CPU, 0.50s total GPU, 1.57s total wall, 18944x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026715ms GPU, 0.033779ms CPU, 0.51s total GPU, 1.60s total wall, 18992x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.030207ms GPU, 0.037004ms CPU, 0.50s total GPU, 1.42s total wall, 16560x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.035398ms GPU, 0.042529ms CPU, 0.50s total GPU, 1.27s total wall, 14128x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.046227ms GPU, 0.053262ms CPU, 0.50s total GPU, 1.07s total wall, 10832x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.068762ms GPU, 0.075610ms CPU, 0.50s total GPU, 0.87s total wall, 7280x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.115839ms GPU, 0.123103ms CPU, 0.50s total GPU, 0.71s total wall, 4320x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.206172ms GPU, 0.212981ms CPU, 0.53s total GPU, 0.66s total wall, 2592x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.381898ms GPU, 0.390947ms CPU, 0.62s total GPU, 0.70s total wall, 1618x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.733048ms GPU, 0.740499ms CPU, 0.50s total GPU, 0.53s total wall, 683x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|---------|--------------|--------|
|        1 |      32 |        32 |            8 |       128 |       256 |  136.000 KiB |     8.000 KiB |         4096 |     32 |  18048x |  34.999 us | 92.87% |  27.717 us | 12.67% |  1.155M |   5.320 GB/s |  0.57% |
|        1 |      64 |        32 |            8 |       128 |       256 |  264.000 KiB |     8.000 KiB |         4096 |     64 |  18944x |  33.304 us | 49.06% |  26.400 us |  3.05% |  2.424M |  10.550 GB/s |  1.13% |
|        1 |     128 |        32 |            8 |       128 |       256 |  520.000 KiB |     8.000 KiB |         4096 |    128 |  18992x |  33.779 us | 76.05% |  26.715 us |  5.07% |  4.791M |  20.239 GB/s |  2.17% |
|        1 |     256 |        32 |            8 |       128 |       256 |    1.008 MiB |     8.000 KiB |         4096 |    256 |  16560x |  37.004 us | 57.33% |  30.207 us |  2.56% |  8.475M |  35.255 GB/s |  3.78% |
|        1 |     512 |        32 |            8 |       128 |       256 |    2.008 MiB |     8.000 KiB |         4096 |    512 |  14128x |  42.529 us | 46.63% |  35.398 us |  2.81% | 14.464M |  59.708 GB/s |  6.40% |
|        1 |    1024 |        32 |            8 |       128 |       256 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10832x |  53.262 us | 41.27% |  46.227 us |  1.90% | 22.152M |  91.088 GB/s |  9.76% |
|        1 |    2048 |        32 |            8 |       128 |       256 |    8.008 MiB |     8.000 KiB |         4096 |   2048 |   7280x |  75.610 us | 10.09% |  68.762 us |  1.71% | 29.784M | 122.233 GB/s | 13.10% |
|        1 |    4096 |        32 |            8 |       128 |       256 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   4320x | 123.103 us | 24.05% | 115.839 us |  0.75% | 35.359M | 144.974 GB/s | 15.54% |
|        1 |    8192 |        32 |            8 |       128 |       256 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2592x | 212.981 us |  3.45% | 206.172 us |  0.99% | 39.734M | 162.829 GB/s | 17.45% |
|        1 |   16384 |        32 |            8 |       128 |       256 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   1618x | 390.947 us | 17.20% | 381.898 us |  0.50% | 42.901M | 175.767 GB/s | 18.84% |
|        1 |   32768 |        32 |            8 |       128 |       256 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |    683x | 740.499 us |  1.43% | 733.048 us |  0.15% | 44.701M | 183.118 GB/s | 19.62% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026852ms GPU, 0.033969ms CPU, 0.50s total GPU, 1.62s total wall, 18624x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026239ms GPU, 0.033209ms CPU, 0.50s total GPU, 1.60s total wall, 19056x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026564ms GPU, 0.033663ms CPU, 0.51s total GPU, 1.63s total wall, 19200x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.029873ms GPU, 0.036797ms CPU, 0.50s total GPU, 1.45s total wall, 16752x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.035296ms GPU, 0.042135ms CPU, 0.50s total GPU, 1.30s total wall, 14240x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.046891ms GPU, 0.053723ms CPU, 0.50s total GPU, 1.05s total wall, 10672x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.071034ms GPU, 0.078568ms CPU, 0.50s total GPU, 0.86s total wall, 7040x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.117021ms GPU, 0.124163ms CPU, 0.50s total GPU, 0.71s total wall, 4288x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.205128ms GPU, 0.216194ms CPU, 0.50s total GPU, 0.63s total wall, 2448x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.380793ms GPU, 0.387625ms CPU, 0.50s total GPU, 0.56s total wall, 1314x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=2 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.732000ms GPU, 0.740641ms CPU, 0.50s total GPU, 0.53s total wall, 684x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|---------|--------------|--------|
|        2 |      32 |        32 |            8 |       128 |       256 |  272.000 KiB |    16.000 KiB |         4096 |     64 |  18624x |  33.969 us |  57.60% |  26.852 us | 10.34% |  2.383M |  10.983 GB/s |  1.18% |
|        2 |      64 |        32 |            8 |       128 |       256 |  528.000 KiB |    16.000 KiB |         4096 |    128 |  19056x |  33.209 us | 120.00% |  26.239 us | 87.42% |  4.878M |  21.230 GB/s |  2.28% |
|        2 |     128 |        32 |            8 |       128 |       256 |    1.016 MiB |    16.000 KiB |         4096 |    256 |  19200x |  33.663 us |  93.10% |  26.564 us |  3.35% |  9.637M |  40.707 GB/s |  4.36% |
|        2 |     256 |        32 |            8 |       128 |       256 |    2.016 MiB |    16.000 KiB |         4096 |    512 |  16752x |  36.797 us |  47.23% |  29.873 us |  2.74% | 17.139M |  71.299 GB/s |  7.64% |
|        2 |     512 |        32 |            8 |       128 |       256 |    4.016 MiB |    16.000 KiB |         4096 |   1024 |  14240x |  42.135 us |  19.62% |  35.296 us |  3.26% | 29.012M | 119.761 GB/s | 12.83% |
|        2 |    1024 |        32 |            8 |       128 |       256 |    8.016 MiB |    16.000 KiB |         4096 |   2048 |  10672x |  53.723 us |  40.74% |  46.891 us | 35.88% | 43.676M | 179.596 GB/s | 19.25% |
|        2 |    2048 |        32 |            8 |       128 |       256 |   16.016 MiB |    16.000 KiB |         4096 |   4096 |   7040x |  78.568 us |  42.97% |  71.034 us |  1.43% | 57.662M | 236.645 GB/s | 25.36% |
|        2 |    4096 |        32 |            8 |       128 |       256 |   32.016 MiB |    16.000 KiB |         4096 |   8192 |   4288x | 124.163 us |  22.62% | 117.021 us |  0.95% | 70.005M | 287.019 GB/s | 30.76% |
|        2 |    8192 |        32 |            8 |       128 |       256 |   64.016 MiB |    16.000 KiB |         4096 |  16384 |   2448x | 216.194 us | 104.02% | 205.128 us |  1.10% | 79.872M | 327.316 GB/s | 35.08% |
|        2 |   16384 |        32 |            8 |       128 |       256 |  128.016 MiB |    16.000 KiB |         4096 |  32768 |   1314x | 387.625 us |   1.83% | 380.793 us |  0.39% | 86.052M | 352.555 GB/s | 37.78% |
|        2 |   32768 |        32 |            8 |       128 |       256 |  256.016 MiB |    16.000 KiB |         4096 |  65536 |    684x | 740.641 us |   6.37% | 732.000 us |  0.26% | 89.530M | 366.760 GB/s | 39.30% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.025441ms GPU, 0.032905ms CPU, 0.50s total GPU, 1.69s total wall, 19664x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.024839ms GPU, 0.031791ms CPU, 0.50s total GPU, 1.66s total wall, 20144x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026248ms GPU, 0.033141ms CPU, 0.50s total GPU, 1.60s total wall, 19056x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.030140ms GPU, 0.037009ms CPU, 0.50s total GPU, 1.42s total wall, 16592x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.037424ms GPU, 0.044356ms CPU, 0.50s total GPU, 1.21s total wall, 13376x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.053924ms GPU, 0.061838ms CPU, 0.50s total GPU, 0.97s total wall, 9280x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.082565ms GPU, 0.089378ms CPU, 0.50s total GPU, 0.80s total wall, 6064x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.126929ms GPU, 0.134269ms CPU, 0.50s total GPU, 0.69s total wall, 3952x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.215762ms GPU, 0.222657ms CPU, 0.50s total GPU, 0.61s total wall, 2320x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.393878ms GPU, 0.401624ms CPU, 0.50s total GPU, 0.56s total wall, 1270x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=4 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.751342ms GPU, 0.758218ms CPU, 0.50s total GPU, 0.53s total wall, 666x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|----------|--------------|--------|
|        4 |      32 |        32 |            8 |       128 |       256 |  544.000 KiB |    32.000 KiB |         4096 |    128 |  19664x |  32.905 us | 131.35% |  25.441 us | 55.94% |   5.031M |  23.184 GB/s |  2.48% |
|        4 |      64 |        32 |            8 |       128 |       256 |    1.031 MiB |    32.000 KiB |         4096 |    256 |  20144x |  31.791 us | 113.03% |  24.839 us | 87.78% |  10.306M |  44.852 GB/s |  4.81% |
|        4 |     128 |        32 |            8 |       128 |       256 |    2.031 MiB |    32.000 KiB |         4096 |    512 |  19056x |  33.141 us |  55.43% |  26.248 us | 34.79% |  19.506M |  82.395 GB/s |  8.83% |
|        4 |     256 |        32 |            8 |       128 |       256 |    4.031 MiB |    32.000 KiB |         4096 |   1024 |  16592x |  37.009 us |  56.74% |  30.140 us | 51.44% |  33.975M | 141.334 GB/s | 15.15% |
|        4 |     512 |        32 |            8 |       128 |       256 |    8.031 MiB |    32.000 KiB |         4096 |   2048 |  13376x |  44.356 us |  34.43% |  37.424 us |  2.17% |  54.724M | 225.901 GB/s | 24.21% |
|        4 |    1024 |        32 |            8 |       128 |       256 |   16.031 MiB |    32.000 KiB |         4096 |   4096 |   9280x |  61.838 us | 185.25% |  53.924 us |  1.91% |  75.959M | 312.344 GB/s | 33.47% |
|        4 |    2048 |        32 |            8 |       128 |       256 |   32.031 MiB |    32.000 KiB |         4096 |   8192 |   6064x |  89.378 us |   8.33% |  82.565 us |  1.27% |  99.219M | 407.195 GB/s | 43.64% |
|        4 |    4096 |        32 |            8 |       128 |       256 |   64.031 MiB |    32.000 KiB |         4096 |  16384 |   3952x | 134.269 us |  28.32% | 126.929 us |  0.87% | 129.080M | 529.230 GB/s | 56.72% |
|        4 |    8192 |        32 |            8 |       128 |       256 |  128.031 MiB |    32.000 KiB |         4096 |  32768 |   2320x | 222.657 us |   3.36% | 215.762 us |  0.59% | 151.871M | 622.367 GB/s | 66.70% |
|        4 |   16384 |        32 |            8 |       128 |       256 |  256.031 MiB |    32.000 KiB |         4096 |  65536 |   1270x | 401.624 us |   8.53% | 393.878 us |  0.42% | 166.387M | 681.686 GB/s | 73.05% |
|        4 |   32768 |        32 |            8 |       128 |       256 |  512.031 MiB |    32.000 KiB |         4096 | 131072 |    666x | 758.218 us |   0.98% | 751.342 us |  0.35% | 174.450M | 714.636 GB/s | 76.59% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.029518ms GPU, 0.036727ms CPU, 0.50s total GPU, 1.48s total wall, 16944x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.029462ms GPU, 0.036348ms CPU, 0.50s total GPU, 1.44s total wall, 16976x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.031841ms GPU, 0.038799ms CPU, 0.50s total GPU, 1.37s total wall, 15712x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.038882ms GPU, 0.046235ms CPU, 0.50s total GPU, 1.18s total wall, 12864x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.053837ms GPU, 0.060592ms CPU, 0.50s total GPU, 0.97s total wall, 9296x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.081995ms GPU, 0.088924ms CPU, 0.50s total GPU, 0.80s total wall, 6112x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.122906ms GPU, 0.129585ms CPU, 0.50s total GPU, 0.70s total wall, 4080x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.205694ms GPU, 0.213214ms CPU, 0.50s total GPU, 0.61s total wall, 2432x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.370525ms GPU, 0.377249ms CPU, 0.50s total GPU, 0.57s total wall, 1360x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.698322ms GPU, 0.715470ms CPU, 0.63s total GPU, 0.68s total wall, 896x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=8 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 1.354609ms GPU, 1.361889ms CPU, 1.02s total GPU, 1.05s total wall, 752x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|----------|--------------|--------|
|        8 |      32 |        32 |            8 |       128 |       256 |    1.062 MiB |    64.000 KiB |       4096.1 |    256 |  16944x |  36.727 us | 115.89% |  29.518 us | 74.16% |   8.673M |  39.963 GB/s |  4.28% |
|        8 |      64 |        32 |            8 |       128 |       256 |    2.062 MiB |    64.000 KiB |       4096.1 |    512 |  16976x |  36.348 us |  45.01% |  29.462 us |  3.16% |  17.379M |  75.632 GB/s |  8.11% |
|        8 |     128 |        32 |            8 |       128 |       256 |    4.062 MiB |    64.000 KiB |       4096.1 |   1024 |  15712x |  38.799 us |  25.20% |  31.841 us |  2.45% |  32.160M | 135.843 GB/s | 14.56% |
|        8 |     256 |        32 |            8 |       128 |       256 |    8.062 MiB |    64.000 KiB |       4096.1 |   2048 |  12864x |  46.235 us | 191.78% |  38.882 us | 70.58% |  52.672M | 219.117 GB/s | 23.48% |
|        8 |     512 |        32 |            8 |       128 |       256 |   16.062 MiB |    64.000 KiB |       4096.1 |   4096 |   9296x |  60.592 us |  12.65% |  53.837 us |  1.73% |  76.082M | 314.067 GB/s | 33.66% |
|        8 |    1024 |        32 |            8 |       128 |       256 |   32.062 MiB |    64.000 KiB |       4096.1 |   8192 |   6112x |  88.924 us |  21.18% |  81.995 us |  1.28% |  99.909M | 410.825 GB/s | 44.03% |
|        8 |    2048 |        32 |            8 |       128 |       256 |   64.062 MiB |    64.000 KiB |       4096.1 |  16384 |   4080x | 129.585 us |   5.58% | 122.906 us |  1.29% | 133.305M | 547.083 GB/s | 58.63% |
|        8 |    4096 |        32 |            8 |       128 |       256 |  128.062 MiB |    64.000 KiB |       4096.1 |  32768 |   2432x | 213.214 us |  18.05% | 205.694 us |  1.01% | 159.305M | 653.149 GB/s | 70.00% |
|        8 |    8192 |        32 |            8 |       128 |       256 |  256.062 MiB |    64.000 KiB |       4096.1 |  65536 |   1360x | 377.249 us |   2.01% | 370.525 us |  0.86% | 176.874M | 724.828 GB/s | 77.68% |
|        8 |   16384 |        32 |            8 |       128 |       256 |  512.062 MiB |    64.000 KiB |       4096.1 | 131072 |    896x | 715.470 us |  44.33% | 698.322 us |  0.71% | 187.696M | 768.989 GB/s | 82.41% |
|        8 |   32768 |        32 |            8 |       128 |       256 |    1.000 GiB |    64.000 KiB |       4096.1 | 262144 |    752x |   1.362 ms |   1.14% |   1.355 ms |  0.58% | 193.520M | 792.755 GB/s | 84.96% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.024702ms GPU, 0.031626ms CPU, 0.50s total GPU, 1.70s total wall, 20256x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026467ms GPU, 0.033423ms CPU, 0.50s total GPU, 1.59s total wall, 18896x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.029799ms GPU, 0.036681ms CPU, 0.50s total GPU, 1.43s total wall, 16784x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.046663ms GPU, 0.053280ms CPU, 0.50s total GPU, 1.05s total wall, 10720x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.078438ms GPU, 0.085355ms CPU, 0.50s total GPU, 0.82s total wall, 6384x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.130079ms GPU, 0.139121ms CPU, 0.50s total GPU, 0.69s total wall, 3856x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.230246ms GPU, 0.238752ms CPU, 0.71s total GPU, 0.86s total wall, 3088x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.425915ms GPU, 0.440029ms CPU, 0.50s total GPU, 0.57s total wall, 1184x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.794394ms GPU, 0.803466ms CPU, 0.51s total GPU, 0.54s total wall, 640x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 1.465497ms GPU, 1.489664ms CPU, 0.91s total GPU, 0.95s total wall, 624x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=16 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 2.836272ms GPU, 2.850167ms CPU, 4.63s total GPU, 4.72s total wall, 1632x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|----------|--------------|--------|
|       16 |      32 |        32 |            8 |       128 |       256 |    2.125 MiB |   128.000 KiB |       4096.1 |    512 |  20256x |  31.626 us |  30.10% |  24.702 us |  9.86% |  20.727M |  95.509 GB/s | 10.24% |
|       16 |      64 |        32 |            8 |       128 |       256 |    4.125 MiB |   128.000 KiB |       4096.1 |   1024 |  18896x |  33.423 us |  85.91% |  26.467 us |  3.25% |  38.690M | 168.379 GB/s | 18.04% |
|       16 |     128 |        32 |            8 |       128 |       256 |    8.125 MiB |   128.000 KiB |       4096.1 |   2048 |  16784x |  36.681 us |  42.07% |  29.799 us |  2.92% |  68.727M | 290.304 GB/s | 31.11% |
|       16 |     256 |        32 |            8 |       128 |       256 |   16.125 MiB |   128.000 KiB |       4096.1 |   4096 |  10720x |  53.280 us |  29.53% |  46.663 us | 25.90% |  87.779M | 365.160 GB/s | 39.13% |
|       16 |     512 |        32 |            8 |       128 |       256 |   32.125 MiB |   128.000 KiB |       4096.1 |   8192 |   6384x |  85.355 us |  28.80% |  78.438 us |  3.13% | 104.439M | 431.123 GB/s | 46.20% |
|       16 |    1024 |        32 |            8 |       128 |       256 |   64.125 MiB |   128.000 KiB |       4096.1 |  16384 |   3856x | 139.121 us | 110.69% | 130.079 us |  3.48% | 125.954M | 517.924 GB/s | 55.50% |
|       16 |    2048 |        32 |            8 |       128 |       256 |  128.125 MiB |   128.000 KiB |       4096.1 |  32768 |   3088x | 238.752 us |  25.17% | 230.246 us | 14.09% | 142.317M | 584.071 GB/s | 62.59% |
|       16 |    4096 |        32 |            8 |       128 |       256 |  256.125 MiB |   128.000 KiB |       4096.1 |  65536 |   1184x | 440.029 us |  59.75% | 425.915 us |  4.18% | 153.871M | 630.872 GB/s | 67.61% |
|       16 |    8192 |        32 |            8 |       128 |       256 |  512.125 MiB |   128.000 KiB |       4096.1 | 131072 |    640x | 803.466 us |   7.99% | 794.394 us |  6.37% | 164.996M | 676.155 GB/s | 72.46% |
|       16 |   16384 |        32 |            8 |       128 |       256 |    1.000 GiB |   128.000 KiB |       4096.1 | 262144 |    624x |   1.490 ms |  25.06% |   1.465 ms |  5.40% | 178.877M | 732.860 GB/s | 78.54% |
|       16 |   32768 |        32 |            8 |       128 |       256 |    2.000 GiB |   128.000 KiB |       4096.1 | 524288 |   1632x |   2.850 ms |   7.15% |   2.836 ms |  1.73% | 184.851M | 757.243 GB/s | 81.15% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.032679ms GPU, 0.039849ms CPU, 0.50s total GPU, 1.37s total wall, 15312x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.033807ms GPU, 0.040758ms CPU, 0.50s total GPU, 1.30s total wall, 14800x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.044274ms GPU, 0.051472ms CPU, 0.50s total GPU, 1.08s total wall, 11296x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.072238ms GPU, 0.078909ms CPU, 0.50s total GPU, 0.84s total wall, 6928x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.115964ms GPU, 0.123322ms CPU, 0.50s total GPU, 0.71s total wall, 4320x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.199668ms GPU, 0.206841ms CPU, 0.50s total GPU, 0.62s total wall, 2512x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.364527ms GPU, 0.372022ms CPU, 0.52s total GPU, 0.59s total wall, 1424x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.692260ms GPU, 0.701054ms CPU, 0.51s total GPU, 0.54s total wall, 736x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 1.326872ms GPU, 1.335066ms CPU, 0.51s total GPU, 0.53s total wall, 384x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 2.526409ms GPU, 2.548519ms CPU, 1.41s total GPU, 1.45s total wall, 560x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=32 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 4.976650ms GPU, 4.983669ms CPU, 0.50s total GPU, 0.51s total wall, 101x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens  | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|---------|---------|------------|--------|------------|--------|----------|--------------|--------|
|       32 |      32 |        32 |            8 |       128 |       256 |    4.250 MiB |   256.000 KiB |       4096.3 |    1024 |  15312x |  39.849 us | 61.05% |  32.679 us | 11.97% |  31.335M | 144.392 GB/s | 15.47% |
|       32 |      64 |        32 |            8 |       128 |       256 |    8.250 MiB |   256.000 KiB |       4096.3 |    2048 |  14800x |  40.758 us | 55.73% |  33.807 us |  2.35% |  60.579M | 263.641 GB/s | 28.25% |
|       32 |     128 |        32 |            8 |       128 |       256 |   16.250 MiB |   256.000 KiB |       4096.3 |    4096 |  11296x |  51.472 us | 75.66% |  44.274 us |  1.61% |  92.514M | 390.781 GB/s | 41.88% |
|       32 |     256 |        32 |            8 |       128 |       256 |   32.250 MiB |   256.000 KiB |       4096.3 |    8192 |   6928x |  78.909 us |  9.34% |  72.238 us |  1.53% | 113.403M | 471.758 GB/s | 50.56% |
|       32 |     512 |        32 |            8 |       128 |       256 |   64.250 MiB |   256.000 KiB |       4096.3 |   16384 |   4320x | 123.322 us | 27.86% | 115.964 us |  0.93% | 141.285M | 583.223 GB/s | 62.50% |
|       32 |    1024 |        32 |            8 |       128 |       256 |  128.250 MiB |   256.000 KiB |       4096.3 |   32768 |   2512x | 206.841 us | 12.21% | 199.668 us |  0.66% | 164.112M | 674.830 GB/s | 72.32% |
|       32 |    2048 |        32 |            8 |       128 |       256 |  256.250 MiB |   256.000 KiB |       4096.3 |   65536 |   1424x | 372.022 us |  8.25% | 364.527 us |  0.86% | 179.783M | 737.831 GB/s | 79.07% |
|       32 |    4096 |        32 |            8 |       128 |       256 |  512.250 MiB |   256.000 KiB |       4096.3 |  131072 |    736x | 701.054 us |  8.22% | 692.260 us |  1.72% | 189.339M | 776.291 GB/s | 83.19% |
|       32 |    8192 |        32 |            8 |       128 |       256 |    1.000 GiB |   256.000 KiB |       4096.3 |  262144 |    384x |   1.335 ms |  3.51% |   1.327 ms |  3.30% | 197.565M | 809.623 GB/s | 86.77% |
|       32 |   16384 |        32 |            8 |       128 |       256 |    2.000 GiB |   256.000 KiB |       4096.3 |  524288 |    560x |   2.549 ms | 12.85% |   2.526 ms |  2.25% | 207.523M | 850.222 GB/s | 91.12% |
|       32 |   32768 |        32 |            8 |       128 |       256 |    4.000 GiB |   256.000 KiB |       4096.3 | 1048576 |    101x |   4.984 ms |  0.19% |   4.977 ms |  0.12% | 210.699M | 863.129 GB/s | 92.50% |

# Sequence length scaling for long context (focused test)
echo "Testing sequence length scaling with KV cache..."
Testing sequence length scaling with KV cache...
S=1 Hqo=32 Hkv=8 D=128 P=256 && for L in 1024 4096 8192 16384 32768; do
  ./build/flash_attention_benchmark_kvcache \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
    -a seq_len=$L --disable-blocking-kernel --md "results_kvcache/seqlen-$L.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.048715ms GPU, 0.055896ms CPU, 0.50s total GPU, 1.06s total wall, 10272x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples | CPU Time  | Noise  | GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|-----------|--------|-----------|--------|---------|--------------|--------|
|        1 |    1024 |        32 |            8 |       128 |       256 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10272x | 55.896 us | 33.95% | 48.715 us | 14.35% | 21.020M |  86.436 GB/s |  9.26% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.125566ms GPU, 0.133141ms CPU, 0.50s total GPU, 0.71s total wall, 3984x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|---------|--------------|--------|
|        1 |    4096 |        32 |            8 |       128 |       256 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   3984x | 133.141 us | 30.00% | 125.566 us | 16.70% | 32.620M | 133.743 GB/s | 14.33% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.232339ms GPU, 0.240088ms CPU, 0.50s total GPU, 0.61s total wall, 2160x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|---------|--------------|--------|
|        1 |    8192 |        32 |            8 |       128 |       256 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2160x | 240.088 us | 19.45% | 232.339 us | 15.22% | 35.259M | 144.490 GB/s | 15.48% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.400717ms GPU, 0.409222ms CPU, 1.01s total GPU, 1.13s total wall, 2512x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|---------|--------------|--------|
|        1 |   16384 |        32 |            8 |       128 |       256 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   2512x | 409.222 us | 17.88% | 400.717 us | 15.11% | 40.887M | 167.513 GB/s | 17.95% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.835681ms GPU, 0.846912ms CPU, 0.67s total GPU, 0.71s total wall, 800x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|---------|--------------|--------|
|        1 |   32768 |        32 |            8 |       128 |       256 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |    800x | 846.912 us | 23.30% | 835.681 us | 20.46% | 39.211M | 160.628 GB/s | 17.21% |

# Page size impact
echo "Testing page size impact with KV cache..."
Testing page size impact with KV cache...
for P in 128 256 512 1024 2048; do
  S=1 Hqo=32 Hkv=8 D=128 && ./build/flash_attention_benchmark_kvcache \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
    --disable-blocking-kernel --md "results_kvcache/pagesize-$P.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=128]
Skip: OOM: %0]
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

No data -- check log.
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.027328ms GPU, 0.034335ms CPU, 0.50s total GPU, 1.56s total wall, 18304x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026692ms GPU, 0.033642ms CPU, 0.50s total GPU, 1.57s total wall, 18736x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026775ms GPU, 0.033662ms CPU, 0.50s total GPU, 1.57s total wall, 18688x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.030172ms GPU, 0.037021ms CPU, 0.50s total GPU, 1.43s total wall, 16576x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.035837ms GPU, 0.042724ms CPU, 0.50s total GPU, 1.26s total wall, 13952x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.046784ms GPU, 0.053647ms CPU, 0.50s total GPU, 1.06s total wall, 10688x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.068951ms GPU, 0.077469ms CPU, 0.50s total GPU, 0.88s total wall, 7264x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.116157ms GPU, 0.123040ms CPU, 0.50s total GPU, 0.71s total wall, 4320x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.206192ms GPU, 0.213513ms CPU, 0.50s total GPU, 0.62s total wall, 2432x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.382043ms GPU, 0.389709ms CPU, 0.50s total GPU, 0.56s total wall, 1309x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.734026ms GPU, 0.740942ms CPU, 0.50s total GPU, 0.53s total wall, 682x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|---------|--------------|--------|
|        1 |      32 |        32 |            8 |       128 |       256 |  136.000 KiB |     8.000 KiB |         4096 |     32 |  18304x |  34.335 us |  57.80% |  27.328 us | 39.87% |  1.171M |   5.396 GB/s |  0.58% |
|        1 |      64 |        32 |            8 |       128 |       256 |  264.000 KiB |     8.000 KiB |         4096 |     64 |  18736x |  33.642 us |  83.06% |  26.692 us |  4.32% |  2.398M |  10.435 GB/s |  1.12% |
|        1 |     128 |        32 |            8 |       128 |       256 |  520.000 KiB |     8.000 KiB |         4096 |    128 |  18688x |  33.662 us |  27.57% |  26.775 us |  2.84% |  4.781M |  20.193 GB/s |  2.16% |
|        1 |     256 |        32 |            8 |       128 |       256 |    1.008 MiB |     8.000 KiB |         4096 |    256 |  16576x |  37.021 us |  52.88% |  30.172 us | 47.75% |  8.485M |  35.296 GB/s |  3.78% |
|        1 |     512 |        32 |            8 |       128 |       256 |    2.008 MiB |     8.000 KiB |         4096 |    512 |  13952x |  42.724 us |  36.63% |  35.837 us | 31.14% | 14.287M |  58.976 GB/s |  6.32% |
|        1 |    1024 |        32 |            8 |       128 |       256 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10688x |  53.647 us |  43.73% |  46.784 us | 41.17% | 21.888M |  90.004 GB/s |  9.65% |
|        1 |    2048 |        32 |            8 |       128 |       256 |    8.008 MiB |     8.000 KiB |         4096 |   2048 |   7264x |  77.469 us | 189.55% |  68.951 us |  3.18% | 29.702M | 121.898 GB/s | 13.06% |
|        1 |    4096 |        32 |            8 |       128 |       256 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   4320x | 123.040 us |   7.26% | 116.157 us |  0.90% | 35.263M | 144.577 GB/s | 15.49% |
|        1 |    8192 |        32 |            8 |       128 |       256 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2432x | 213.513 us |  12.71% | 206.192 us |  0.50% | 39.730M | 162.813 GB/s | 17.45% |
|        1 |   16384 |        32 |            8 |       128 |       256 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   1309x | 389.709 us |   8.49% | 382.043 us |  0.26% | 42.885M | 175.701 GB/s | 18.83% |
|        1 |   32768 |        32 |            8 |       128 |       256 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |    682x | 740.942 us |   0.96% | 734.026 us |  0.20% | 44.641M | 182.874 GB/s | 19.60% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.027648ms GPU, 0.034963ms CPU, 0.50s total GPU, 1.57s total wall, 18096x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.026602ms GPU, 0.033777ms CPU, 0.50s total GPU, 1.57s total wall, 18800x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.026548ms GPU, 0.033329ms CPU, 0.50s total GPU, 1.57s total wall, 18848x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.030342ms GPU, 0.037126ms CPU, 0.50s total GPU, 1.40s total wall, 16480x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.035438ms GPU, 0.042447ms CPU, 0.50s total GPU, 1.27s total wall, 14112x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.046608ms GPU, 0.053437ms CPU, 0.50s total GPU, 1.06s total wall, 10768x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.068732ms GPU, 0.076805ms CPU, 0.50s total GPU, 0.87s total wall, 7280x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.115700ms GPU, 0.122338ms CPU, 0.51s total GPU, 0.72s total wall, 4368x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.205766ms GPU, 0.213056ms CPU, 0.50s total GPU, 0.62s total wall, 2430x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.381001ms GPU, 0.387579ms CPU, 0.50s total GPU, 0.56s total wall, 1313x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=512]
Pass: Cold: 0.731910ms GPU, 0.740511ms CPU, 0.50s total GPU, 0.53s total wall, 684x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  |  Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|---------|---------|--------------|--------|
|        1 |      32 |        32 |            8 |       128 |       512 |  136.000 KiB |     8.000 KiB |         4096 |     32 |  18096x |  34.963 us |  91.79% |  27.648 us |  12.23% |  1.157M |   5.333 GB/s |  0.57% |
|        1 |      64 |        32 |            8 |       128 |       512 |  264.000 KiB |     8.000 KiB |         4096 |     64 |  18800x |  33.777 us | 140.97% |  26.602 us |  87.05% |  2.406M |  10.470 GB/s |  1.12% |
|        1 |     128 |        32 |            8 |       128 |       512 |  520.000 KiB |     8.000 KiB |         4096 |    128 |  18848x |  33.329 us |  25.69% |  26.548 us |   3.07% |  4.821M |  20.366 GB/s |  2.18% |
|        1 |     256 |        32 |            8 |       128 |       512 |    1.008 MiB |     8.000 KiB |         4096 |    256 |  16480x |  37.126 us | 265.51% |  30.342 us | 264.51% |  8.437M |  35.099 GB/s |  3.76% |
|        1 |     512 |        32 |            8 |       128 |       512 |    2.008 MiB |     8.000 KiB |         4096 |    512 |  14112x |  42.447 us |  64.54% |  35.438 us |  45.99% | 14.448M |  59.640 GB/s |  6.39% |
|        1 |    1024 |        32 |            8 |       128 |       512 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10768x |  53.437 us |  40.61% |  46.608 us |   2.47% | 21.970M |  90.343 GB/s |  9.68% |
|        1 |    2048 |        32 |            8 |       128 |       512 |    8.008 MiB |     8.000 KiB |         4096 |   2048 |   7280x |  76.805 us | 168.90% |  68.732 us |   2.52% | 29.797M | 122.287 GB/s | 13.11% |
|        1 |    4096 |        32 |            8 |       128 |       512 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   4368x | 122.338 us |   5.87% | 115.700 us |   1.29% | 35.402M | 145.148 GB/s | 15.56% |
|        1 |    8192 |        32 |            8 |       128 |       512 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2430x | 213.056 us |  17.57% | 205.766 us |   0.49% | 39.812M | 163.151 GB/s | 17.48% |
|        1 |   16384 |        32 |            8 |       128 |       512 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   1313x | 387.579 us |   1.75% | 381.001 us |   0.29% | 43.002M | 176.181 GB/s | 18.88% |
|        1 |   32768 |        32 |            8 |       128 |       512 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |    684x | 740.511 us |   7.22% | 731.910 us |   0.20% | 44.771M | 183.402 GB/s | 19.65% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.027623ms GPU, 0.034779ms CPU, 0.50s total GPU, 1.57s total wall, 18112x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.026360ms GPU, 0.033233ms CPU, 0.50s total GPU, 1.59s total wall, 18976x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.026698ms GPU, 0.033617ms CPU, 0.50s total GPU, 1.57s total wall, 18736x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.029990ms GPU, 0.036654ms CPU, 0.50s total GPU, 1.43s total wall, 16688x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.035506ms GPU, 0.042172ms CPU, 0.50s total GPU, 1.28s total wall, 14096x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.046404ms GPU, 0.053074ms CPU, 0.50s total GPU, 1.07s total wall, 10784x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.068793ms GPU, 0.075717ms CPU, 0.50s total GPU, 0.87s total wall, 7280x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.115575ms GPU, 0.125527ms CPU, 0.50s total GPU, 0.72s total wall, 4336x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.205506ms GPU, 0.212883ms CPU, 0.56s total GPU, 0.69s total wall, 2704x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.380359ms GPU, 0.389021ms CPU, 0.50s total GPU, 0.56s total wall, 1315x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=1024]
Pass: Cold: 0.730187ms GPU, 0.739017ms CPU, 0.50s total GPU, 0.53s total wall, 685x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  |  Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|---------|---------|--------------|--------|
|        1 |      32 |        32 |            8 |       128 |      1024 |  136.000 KiB |     8.000 KiB |         4096 |     32 |  18112x |  34.779 us |  56.80% |  27.623 us |  21.30% |  1.158M |   5.338 GB/s |  0.57% |
|        1 |      64 |        32 |            8 |       128 |      1024 |  264.000 KiB |     8.000 KiB |         4096 |     64 |  18976x |  33.233 us |  79.75% |  26.360 us |  75.36% |  2.428M |  10.567 GB/s |  1.13% |
|        1 |     128 |        32 |            8 |       128 |      1024 |  520.000 KiB |     8.000 KiB |         4096 |    128 |  18736x |  33.617 us | 176.60% |  26.698 us | 168.31% |  4.794M |  20.251 GB/s |  2.17% |
|        1 |     256 |        32 |            8 |       128 |      1024 |    1.008 MiB |     8.000 KiB |         4096 |    256 |  16688x |  36.654 us |  50.83% |  29.990 us |  45.68% |  8.536M |  35.510 GB/s |  3.81% |
|        1 |     512 |        32 |            8 |       128 |      1024 |    2.008 MiB |     8.000 KiB |         4096 |    512 |  14096x |  42.172 us |  51.79% |  35.506 us |  48.12% | 14.420M |  59.526 GB/s |  6.38% |
|        1 |    1024 |        32 |            8 |       128 |      1024 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10784x |  53.074 us |  14.44% |  46.404 us |   1.53% | 22.067M |  90.740 GB/s |  9.72% |
|        1 |    2048 |        32 |            8 |       128 |      1024 |    8.008 MiB |     8.000 KiB |         4096 |   2048 |   7280x |  75.717 us |  33.81% |  68.793 us |   1.16% | 29.771M | 122.179 GB/s | 13.09% |
|        1 |    4096 |        32 |            8 |       128 |      1024 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   4336x | 125.527 us | 135.78% | 115.575 us |   3.65% | 35.440M | 145.304 GB/s | 15.57% |
|        1 |    8192 |        32 |            8 |       128 |      1024 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2704x | 212.883 us |  19.51% | 205.506 us |   1.05% | 39.863M | 163.357 GB/s | 17.51% |
|        1 |   16384 |        32 |            8 |       128 |      1024 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   1315x | 389.021 us |  14.01% | 380.359 us |   0.28% | 43.075M | 176.479 GB/s | 18.91% |
|        1 |   32768 |        32 |            8 |       128 |      1024 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |    685x | 739.017 us |   7.87% | 730.187 us |   0.17% | 44.876M | 183.835 GB/s | 19.70% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.027278ms GPU, 0.034347ms CPU, 0.50s total GPU, 1.57s total wall, 18336x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.026466ms GPU, 0.033586ms CPU, 0.50s total GPU, 1.59s total wall, 18896x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.026713ms GPU, 0.033755ms CPU, 0.50s total GPU, 1.56s total wall, 18720x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.029773ms GPU, 0.036610ms CPU, 0.50s total GPU, 1.44s total wall, 16800x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.035522ms GPU, 0.042434ms CPU, 0.50s total GPU, 1.27s total wall, 14080x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.046229ms GPU, 0.053103ms CPU, 0.50s total GPU, 1.06s total wall, 10816x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.068851ms GPU, 0.075893ms CPU, 0.50s total GPU, 0.87s total wall, 7264x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.115352ms GPU, 0.122499ms CPU, 0.51s total GPU, 0.71s total wall, 4384x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.205802ms GPU, 0.212465ms CPU, 0.50s total GPU, 0.61s total wall, 2432x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.380252ms GPU, 0.388128ms CPU, 0.50s total GPU, 0.56s total wall, 1315x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=2048]
Pass: Cold: 0.729398ms GPU, 0.743008ms CPU, 0.50s total GPU, 0.54s total wall, 686x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|---------|--------------|--------|
|        1 |      32 |        32 |            8 |       128 |      2048 |  136.000 KiB |     8.000 KiB |         4096 |     32 |  18336x |  34.347 us | 81.49% |  27.278 us | 46.69% |  1.173M |   5.406 GB/s |  0.58% |
|        1 |      64 |        32 |            8 |       128 |      2048 |  264.000 KiB |     8.000 KiB |         4096 |     64 |  18896x |  33.586 us | 96.76% |  26.466 us |  3.30% |  2.418M |  10.524 GB/s |  1.13% |
|        1 |     128 |        32 |            8 |       128 |      2048 |  520.000 KiB |     8.000 KiB |         4096 |    128 |  18720x |  33.755 us | 90.85% |  26.713 us | 45.41% |  4.792M |  20.240 GB/s |  2.17% |
|        1 |     256 |        32 |            8 |       128 |      2048 |    1.008 MiB |     8.000 KiB |         4096 |    256 |  16800x |  36.610 us | 23.16% |  29.773 us |  3.35% |  8.598M |  35.769 GB/s |  3.83% |
|        1 |     512 |        32 |            8 |       128 |      2048 |    2.008 MiB |     8.000 KiB |         4096 |    512 |  14080x |  42.434 us | 22.76% |  35.522 us |  3.91% | 14.413M |  59.499 GB/s |  6.38% |
|        1 |    1024 |        32 |            8 |       128 |      2048 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10816x |  53.103 us | 14.92% |  46.229 us |  1.52% | 22.151M |  91.083 GB/s |  9.76% |
|        1 |    2048 |        32 |            8 |       128 |      2048 |    8.008 MiB |     8.000 KiB |         4096 |   2048 |   7264x |  75.893 us | 27.03% |  68.851 us |  3.37% | 29.746M | 122.076 GB/s | 13.08% |
|        1 |    4096 |        32 |            8 |       128 |      2048 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   4384x | 122.499 us | 19.92% | 115.352 us |  0.71% | 35.509M | 145.585 GB/s | 15.60% |
|        1 |    8192 |        32 |            8 |       128 |      2048 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2432x | 212.465 us |  3.32% | 205.802 us |  0.75% | 39.805M | 163.122 GB/s | 17.48% |
|        1 |   16384 |        32 |            8 |       128 |      2048 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   1315x | 388.128 us | 12.49% | 380.252 us |  0.31% | 43.087M | 176.528 GB/s | 18.92% |
|        1 |   32768 |        32 |            8 |       128 |      2048 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |    686x | 743.008 us | 14.70% | 729.398 us |  0.20% | 44.925M | 184.034 GB/s | 19.72% |

# GQA ratio tests in KV cache context
echo "Testing GQA ratio impact with KV cache..."
Testing GQA ratio impact with KV cache...
S=1 D=128 P=256 && for R in 1 4 5 8; do
  Hqo=32 Hkv=$((Hqo / R))
  ./build/flash_attention_benchmark_kvcache \
    -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
    --disable-blocking-kernel --md "results_kvcache/gqa-$R.md"
done
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.024416ms GPU, 0.031493ms CPU, 0.50s total GPU, 1.84s total wall, 20480x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.024839ms GPU, 0.031451ms CPU, 0.50s total GPU, 1.77s total wall, 20144x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.026273ms GPU, 0.033515ms CPU, 0.50s total GPU, 1.71s total wall, 19040x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.030406ms GPU, 0.037062ms CPU, 0.50s total GPU, 1.51s total wall, 16448x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.038409ms GPU, 0.045150ms CPU, 0.50s total GPU, 1.28s total wall, 13024x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.055473ms GPU, 0.062267ms CPU, 0.50s total GPU, 1.02s total wall, 9024x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.083770ms GPU, 0.090944ms CPU, 0.50s total GPU, 0.84s total wall, 5984x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.129006ms GPU, 0.136639ms CPU, 0.50s total GPU, 0.71s total wall, 3888x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.219558ms GPU, 0.226731ms CPU, 0.50s total GPU, 0.63s total wall, 2288x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.401154ms GPU, 0.413305ms CPU, 0.90s total GPU, 1.03s total wall, 2240x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=32 head_size=128 page_size=256]
Pass: Cold: 0.764530ms GPU, 0.771195ms CPU, 0.50s total GPU, 0.53s total wall, 654x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|---------|--------------|--------|
|        1 |      32 |        32 |           32 |       128 |       256 |  520.000 KiB |     8.000 KiB |        16384 |     32 |  20480x |  31.493 us |  61.29% |  24.416 us |  8.89% |  1.311M |  22.144 GB/s |  2.37% |
|        1 |      64 |        32 |           32 |       128 |       256 |    1.008 MiB |     8.000 KiB |        16384 |     64 |  20144x |  31.451 us |  51.74% |  24.839 us | 44.35% |  2.577M |  42.875 GB/s |  4.59% |
|        1 |     128 |        32 |           32 |       128 |       256 |    2.008 MiB |     8.000 KiB |        16384 |    128 |  19040x |  33.515 us | 241.92% |  26.273 us |  4.89% |  4.872M |  80.446 GB/s |  8.62% |
|        1 |     256 |        32 |           32 |       128 |       256 |    4.008 MiB |     8.000 KiB |        16384 |    256 |  16448x |  37.062 us |  51.55% |  30.406 us | 46.65% |  8.419M | 138.481 GB/s | 14.84% |
|        1 |     512 |        32 |           32 |       128 |       256 |    8.008 MiB |     8.000 KiB |        16384 |    512 |  13024x |  45.150 us |  35.04% |  38.409 us |  3.09% | 13.330M | 218.830 GB/s | 23.45% |
|        1 |    1024 |        32 |           32 |       128 |       256 |   16.008 MiB |     8.000 KiB |        16384 |   1024 |   9024x |  62.267 us |  13.18% |  55.473 us |  3.96% | 18.459M | 302.733 GB/s | 32.44% |
|        1 |    2048 |        32 |           32 |       128 |       256 |   32.008 MiB |     8.000 KiB |        16384 |   2048 |   5984x |  90.944 us |  37.40% |  83.770 us |  1.86% | 24.448M | 400.751 GB/s | 42.95% |
|        1 |    4096 |        32 |           32 |       128 |       256 |   64.008 MiB |     8.000 KiB |        16384 |   4096 |   3888x | 136.639 us |  19.20% | 129.006 us |  0.92% | 31.751M | 520.328 GB/s | 55.76% |
|        1 |    8192 |        32 |           32 |       128 |       256 |  128.008 MiB |     8.000 KiB |        16384 |   8192 |   2288x | 226.731 us |  13.50% | 219.558 us |  0.65% | 37.311M | 611.382 GB/s | 65.52% |
|        1 |   16384 |        32 |           32 |       128 |       256 |  256.008 MiB |     8.000 KiB |        16384 |  16384 |   2240x | 413.305 us |  56.75% | 401.154 us |  0.82% | 40.842M | 669.198 GB/s | 71.72% |
|        1 |   32768 |        32 |           32 |       128 |       256 |  512.008 MiB |     8.000 KiB |        16384 |  32768 |    654x | 771.195 us |   0.92% | 764.530 us |  0.30% | 42.860M | 702.245 GB/s | 75.26% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.027203ms GPU, 0.034472ms CPU, 0.50s total GPU, 1.57s total wall, 18384x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026503ms GPU, 0.033379ms CPU, 0.50s total GPU, 1.59s total wall, 18880x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.026800ms GPU, 0.033755ms CPU, 0.50s total GPU, 1.57s total wall, 18672x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.029957ms GPU, 0.037476ms CPU, 0.50s total GPU, 1.45s total wall, 16704x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.035567ms GPU, 0.043337ms CPU, 0.50s total GPU, 1.29s total wall, 14064x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.046492ms GPU, 0.054552ms CPU, 0.50s total GPU, 1.08s total wall, 10768x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.068914ms GPU, 0.076119ms CPU, 0.50s total GPU, 0.88s total wall, 7264x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.116088ms GPU, 0.123084ms CPU, 0.50s total GPU, 0.71s total wall, 4320x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.205933ms GPU, 0.217210ms CPU, 0.50s total GPU, 0.63s total wall, 2432x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.381608ms GPU, 0.390906ms CPU, 0.50s total GPU, 0.56s total wall, 1311x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.734015ms GPU, 0.753750ms CPU, 0.86s total GPU, 0.93s total wall, 1168x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|--------|---------|--------------|--------|
|        1 |      32 |        32 |            8 |       128 |       256 |  136.000 KiB |     8.000 KiB |         4096 |     32 |  18384x |  34.472 us | 134.84% |  27.203 us | 79.53% |  1.176M |   5.421 GB/s |  0.58% |
|        1 |      64 |        32 |            8 |       128 |       256 |  264.000 KiB |     8.000 KiB |         4096 |     64 |  18880x |  33.379 us |  27.97% |  26.503 us |  4.61% |  2.415M |  10.509 GB/s |  1.13% |
|        1 |     128 |        32 |            8 |       128 |       256 |  520.000 KiB |     8.000 KiB |         4096 |    128 |  18672x |  33.755 us | 112.39% |  26.800 us |  3.99% |  4.776M |  20.174 GB/s |  2.16% |
|        1 |     256 |        32 |            8 |       128 |       256 |    1.008 MiB |     8.000 KiB |         4096 |    256 |  16704x |  37.476 us | 281.03% |  29.957 us | 49.12% |  8.546M |  35.550 GB/s |  3.81% |
|        1 |     512 |        32 |            8 |       128 |       256 |    2.008 MiB |     8.000 KiB |         4096 |    512 |  14064x |  43.337 us | 256.35% |  35.567 us |  3.95% | 14.395M |  59.425 GB/s |  6.37% |
|        1 |    1024 |        32 |            8 |       128 |       256 |    4.008 MiB |     8.000 KiB |         4096 |   1024 |  10768x |  54.552 us | 226.46% |  46.492 us |  2.65% | 22.025M |  90.569 GB/s |  9.71% |
|        1 |    2048 |        32 |            8 |       128 |       256 |    8.008 MiB |     8.000 KiB |         4096 |   2048 |   7264x |  76.119 us |  43.14% |  68.914 us |  2.32% | 29.718M | 121.964 GB/s | 13.07% |
|        1 |    4096 |        32 |            8 |       128 |       256 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   4320x | 123.084 us |  17.11% | 116.088 us |  0.98% | 35.284M | 144.663 GB/s | 15.50% |
|        1 |    8192 |        32 |            8 |       128 |       256 |   32.008 MiB |     8.000 KiB |         4096 |   8192 |   2432x | 217.210 us |  94.87% | 205.933 us |  2.61% | 39.780M | 163.018 GB/s | 17.47% |
|        1 |   16384 |        32 |            8 |       128 |       256 |   64.008 MiB |     8.000 KiB |         4096 |  16384 |   1311x | 390.906 us |  16.56% | 381.608 us |  0.32% | 42.934M | 175.901 GB/s | 18.85% |
|        1 |   32768 |        32 |            8 |       128 |       256 |  128.008 MiB |     8.000 KiB |         4096 |  32768 |   1168x | 753.750 us |  42.49% | 734.015 us |  0.59% | 44.642M | 182.876 GB/s | 19.60% |
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=6 head_size=128 page_size=256]
Skip: OOM: R~
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

No data -- check log.
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.030588ms GPU, 0.037616ms CPU, 0.50s total GPU, 1.45s total wall, 16352x 
Run:  [2/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=64 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.029293ms GPU, 0.036171ms CPU, 0.50s total GPU, 1.46s total wall, 17072x 
Run:  [3/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=128 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.029158ms GPU, 0.036129ms CPU, 0.50s total GPU, 1.48s total wall, 17152x 
Run:  [4/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=256 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.033079ms GPU, 0.039594ms CPU, 0.50s total GPU, 1.34s total wall, 15120x 
Run:  [5/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=512 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.037950ms GPU, 0.044909ms CPU, 0.50s total GPU, 1.24s total wall, 13296x 
Run:  [6/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=1024 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.048782ms GPU, 0.057027ms CPU, 0.50s total GPU, 1.05s total wall, 10256x 
Run:  [7/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=2048 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.070844ms GPU, 0.078463ms CPU, 0.50s total GPU, 0.87s total wall, 7072x 
Run:  [8/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.115035ms GPU, 0.125295ms CPU, 0.50s total GPU, 0.73s total wall, 4352x 
Run:  [9/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=8192 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.206442ms GPU, 0.214685ms CPU, 0.65s total GPU, 0.82s total wall, 3168x 
Run:  [10/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=16384 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.384885ms GPU, 0.394576ms CPU, 0.80s total GPU, 0.90s total wall, 2075x 
Run:  [11/11] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=32768 num_heads=32 num_kv_heads=4 head_size=128 page_size=256]
Pass: Cold: 0.735887ms GPU, 0.757795ms CPU, 0.50s total GPU, 0.54s total wall, 680x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  |  Noise  |  GPU Time  |  Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|---------|------------|---------|---------|--------------|--------|
|        1 |      32 |        32 |            4 |       128 |       256 |   72.000 KiB |     8.000 KiB |         2048 |     32 |  16352x |  37.616 us |  33.03% |  30.588 us |  12.71% |  1.046M |   2.678 GB/s |  0.29% |
|        1 |      64 |        32 |            4 |       128 |       256 |  136.000 KiB |     8.000 KiB |         2048 |     64 |  17072x |  36.171 us |  42.21% |  29.293 us |  34.74% |  2.185M |   5.034 GB/s |  0.54% |
|        1 |     128 |        32 |            4 |       128 |       256 |  264.000 KiB |     8.000 KiB |         2048 |    128 |  17152x |  36.129 us |  44.95% |  29.158 us |   4.27% |  4.390M |   9.552 GB/s |  1.02% |
|        1 |     256 |        32 |            4 |       128 |       256 |  520.000 KiB |     8.000 KiB |         2048 |    256 |  15120x |  39.594 us |  89.55% |  33.079 us | 266.34% |  7.739M |  16.345 GB/s |  1.75% |
|        1 |     512 |        32 |            4 |       128 |       256 |    1.008 MiB |     8.000 KiB |         2048 |    512 |  13296x |  44.909 us |  75.34% |  37.950 us |  47.92% | 13.491M |  28.062 GB/s |  3.01% |
|        1 |    1024 |        32 |            4 |       128 |       256 |    2.008 MiB |     8.000 KiB |         2048 |   1024 |  10256x |  57.027 us | 235.43% |  48.782 us |  38.64% | 20.991M |  43.326 GB/s |  4.64% |
|        1 |    2048 |        32 |            4 |       128 |       256 |    4.008 MiB |     8.000 KiB |         2048 |   2048 |   7072x |  78.463 us |  63.66% |  70.844 us |  33.14% | 28.909M |  59.436 GB/s |  6.37% |
|        1 |    4096 |        32 |            4 |       128 |       256 |    8.008 MiB |     8.000 KiB |         2048 |   4096 |   4352x | 125.295 us | 142.38% | 115.035 us |   1.62% | 35.607M |  73.065 GB/s |  7.83% |
|        1 |    8192 |        32 |            4 |       128 |       256 |   16.008 MiB |     8.000 KiB |         2048 |   8192 |   3168x | 214.685 us |  24.65% | 206.442 us |   2.39% | 39.682M |  81.348 GB/s |  8.72% |
|        1 |   16384 |        32 |            4 |       128 |       256 |   32.008 MiB |     8.000 KiB |         2048 |  16384 |   2075x | 394.576 us |  18.25% | 384.885 us |   0.50% | 42.569M |  87.223 GB/s |  9.35% |
|        1 |   32768 |        32 |            4 |       128 |       256 |   64.008 MiB |     8.000 KiB |         2048 |  32768 |    680x | 757.795 us |  50.30% | 735.887 us |   0.38% | 44.529M |  91.217 GB/s |  9.78% |

# Special test for prefill phase (batch size = 1, but longer sequence)
echo "Testing prefill-like workload with KV cache..."
Testing prefill-like workload with KV cache...
S=1 Hqo=32 Hkv=8 D=128 P=256 L=4096 && ./build/flash_attention_benchmark_kvcache \
  -a num_seqs=$S -a num_heads=$Hqo -a num_kv_heads=$Hkv -a head_size=$D -a page_size=$P \
  -a seq_len=$L --disable-blocking-kernel --md "results_kvcache/prefill-4k.md"
# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/1] run_mha_varlen_fwd_kvcache [Device=0 num_seqs=1 seq_len=4096 num_heads=32 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.133776ms GPU, 0.142459ms CPU, 0.50s total GPU, 0.70s total wall, 3744x 
```

# Benchmark Results

## run_mha_varlen_fwd_kvcache

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  | Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|--------|---------|------------|--------|------------|--------|---------|--------------|--------|
|        1 |    4096 |        32 |            8 |       128 |       256 |   16.008 MiB |     8.000 KiB |         4096 |   4096 |   3744x | 142.459 us | 54.89% | 133.776 us | 18.96% | 30.618M | 125.536 GB/s | 13.45% |

echo "All benchmarks completed successfully!"
All benchmarks completed successfully!

# Calculate total execution time
END_TIME=$(date +%s)
DURATION=$((END_TIME - START_TIME))

# Convert to hours, minutes, seconds
HOURS=$((DURATION / 3600))
MINUTES=$(( (DURATION % 3600) / 60 ))
SECONDS=$((DURATION % 60))

echo ""

echo "=================================================================="
==================================================================
echo "                       BENCHMARK SUMMARY                          "
                       BENCHMARK SUMMARY                          
echo "=================================================================="
==================================================================
echo "Start time: $(date -d @$START_TIME)"
Start time: Mon Mar  3 06:18:33 UTC 2025
echo "End time:   $(date -d @$END_TIME)"
End time:   Mon Mar  3 06:44:00 UTC 2025
echo "----------------------------------------------------------------"
----------------------------------------------------------------
echo "Total execution time: $HOURS hours, $MINUTES minutes, $SECONDS seconds"
Total execution time: 0 hours, 25 minutes, 27 seconds
echo "                    = $DURATION seconds"
                    = 1527 seconds
echo "----------------------------------------------------------------"
----------------------------------------------------------------
echo "GPU used: CUDA_VISIBLE_DEVICES=$CUDA_VISIBLE_DEVICES"
GPU used: CUDA_VISIBLE_DEVICES=7
echo "=================================================================="
==================================================================
