# Devices

## [0] `NVIDIA A30`
* SM Version: 800 (PTX Version: 800)
* Number of SMs: 56
* SM Default Clock Rate: 1440 MHz
* Global Memory: 23805 MiB Free / 24060 MiB Total
* Global Memory Bus Peak: 933 GB/sec (3072-bit DDR @1215MHz)
* Max Shared Memory: 164 KiB/SM, 48 KiB/Block
* L2 Cache Size: 24576 KiB
* Maximum Active Blocks: 32/SM
* Maximum Active Threads: 2048/SM, 1024/Block
* Available Registers: 65536/SM, 65536/Block
* ECC Enabled: Yes

# Log

```
Run:  [1/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=32 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.048407ms GPU, 0.055527ms CPU, 0.50s total GPU, 1.06s total wall, 10336x 
Run:  [2/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=64 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.052111ms GPU, 0.059063ms CPU, 0.50s total GPU, 0.99s total wall, 9600x 
Run:  [3/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=128 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.071030ms GPU, 0.078085ms CPU, 0.50s total GPU, 0.85s total wall, 7040x 
Run:  [4/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=256 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.113939ms GPU, 0.122402ms CPU, 0.52s total GPU, 0.75s total wall, 4592x 
Run:  [5/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=512 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.192967ms GPU, 0.200375ms CPU, 0.50s total GPU, 0.62s total wall, 2592x 
Run:  [6/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=1024 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.346738ms GPU, 0.354445ms CPU, 0.50s total GPU, 0.57s total wall, 1443x 
Run:  [7/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=2048 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 0.650152ms GPU, 0.658199ms CPU, 0.50s total GPU, 0.54s total wall, 770x 
Run:  [8/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=4096 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 1.260384ms GPU, 1.269971ms CPU, 0.50s total GPU, 0.52s total wall, 397x 
Run:  [9/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=8192 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 2.483834ms GPU, 2.527987ms CPU, 0.50s total GPU, 0.52s total wall, 202x 
Run:  [10/10] run_mha_varlen_fwd [Device=0 num_seqs=64 seq_len=16384 num_heads=64 num_kv_heads=8 head_size=128 page_size=256]
Pass: Cold: 4.929255ms GPU, 4.936101ms CPU, 0.50s total GPU, 0.51s total wall, 102x 
```

# Benchmark Results

## run_mha_varlen_fwd

### [0] NVIDIA A30

| num_seqs | seq_len | num_heads | num_kv_heads | head_size | page_size | Memory Reads | Memory Writes | Memory Usage | Tokens  | Samples |  CPU Time  | Noise  |  GPU Time  | Noise  |  Elem/s  | GlobalMem BW | BWUtil |
|----------|---------|-----------|--------------|-----------|-----------|--------------|---------------|--------------|---------|---------|------------|--------|------------|--------|----------|--------------|--------|
|       64 |      32 |        64 |            8 |       128 |       256 |    9.000 MiB |     1.000 MiB |         4097 |    2048 |  10336x |  55.527 us | 65.47% |  48.407 us | 43.57% |  42.308M | 216.614 GB/s | 23.21% |
|       64 |      64 |        64 |            8 |       128 |       256 |   17.000 MiB |     1.000 MiB |         4097 |    4096 |   9600x |  59.063 us | 35.24% |  52.111 us |  1.66% |  78.601M | 362.195 GB/s | 38.82% |
|       64 |     128 |        64 |            8 |       128 |       256 |   33.000 MiB |     1.000 MiB |         4097 |    8192 |   7040x |  78.085 us | 47.44% |  71.030 us |  1.84% | 115.332M | 501.926 GB/s | 53.79% |
|       64 |     256 |        64 |            8 |       128 |       256 |   65.000 MiB |     1.000 MiB |         4097 |   16384 |   4592x | 122.402 us | 80.70% | 113.939 us |  1.19% | 143.797M | 607.398 GB/s | 65.09% |
|       64 |     512 |        64 |            8 |       128 |       256 |  129.000 MiB |     1.000 MiB |         4097 |   32768 |   2592x | 200.375 us | 13.56% | 192.967 us |  0.82% | 169.812M | 706.417 GB/s | 75.70% |
|       64 |    1024 |        64 |            8 |       128 |       256 |  257.000 MiB |     1.000 MiB |         4097 |   65536 |   1443x | 354.445 us | 10.74% | 346.738 us |  0.49% | 189.007M | 780.222 GB/s | 83.61% |
|       64 |    2048 |        64 |            8 |       128 |       256 |  513.000 MiB |     1.000 MiB |         4097 |  131072 |    770x | 658.199 us |  5.65% | 650.152 us |  0.32% | 201.602M | 828.987 GB/s | 88.84% |
|       64 |    4096 |        64 |            8 |       128 |       256 |    1.001 GiB |     1.000 MiB |         4097 |  262144 |    397x |   1.270 ms |  4.50% |   1.260 ms |  0.24% | 207.987M | 853.580 GB/s | 91.48% |
|       64 |    8192 |        64 |            8 |       128 |       256 |    2.001 GiB |     1.000 MiB |         4097 |  524288 |    202x |   2.528 ms | 21.12% |   2.484 ms |  0.18% | 211.080M | 865.429 GB/s | 92.75% |
|       64 |   16384 |        64 |            8 |       128 |       256 |    4.001 GiB |     1.000 MiB |         4097 | 1048576 |    102x |   4.936 ms |  0.18% |   4.929 ms |  0.11% | 212.725M | 871.747 GB/s | 93.42% |
